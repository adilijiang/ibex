#LyX 2.1 created this file. For more info see http://www.lyx.org/
\lyxformat 474
\begin_document
\begin_header
\textclass article
\begin_preamble
\usepackage{multicol}

\renewcommand{\arraystretch}{1.5}

\let\oldpart\part
\renewcommand\part{\clearpage\oldpart}

\allowdisplaybreaks
\end_preamble
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_math auto
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\float_placement H
\paperfontsize default
\spacing single
\use_hyperref true
\pdf_bookmarks true
\pdf_bookmarksnumbered false
\pdf_bookmarksopen false
\pdf_bookmarksopenlevel 1
\pdf_breaklinks false
\pdf_pdfborder false
\pdf_colorlinks true
\pdf_backref false
\pdf_pdfusetitle true
\papersize default
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2.5cm
\topmargin 2.5cm
\rightmargin 2.5cm
\bottommargin 2.5cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation skip
\defskip smallskip
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Radial basis functions for neutron transport: theory manual
\end_layout

\begin_layout Author
Brody Bassett
\end_layout

\begin_layout Standard
\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout Part
Discretization of the neutron transport equation
\end_layout

\begin_layout Section
Introduction to transport equation
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="14" columns="3">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="middle" width="20text%">
<column alignment="center" valignment="top" width="60text%">
<column alignment="center" valignment="middle" width="20text%">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Variable
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Units
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\bm{x}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Position
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
cm
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $E$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Energy
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
MeV
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\bm{\Omega}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Direction
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
steradian
\begin_inset Formula $^{-1}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $t$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Time
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
s
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\psi\left(\bm{x},\bm{\Omega},E,t\right)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Angular flux at position 
\begin_inset Formula $\bm{x}$
\end_inset

 in direction 
\begin_inset Formula $\bm{\Omega}$
\end_inset

 with energy 
\begin_inset Formula $E$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
particles cm
\begin_inset Formula $^{-2}$
\end_inset

 s
\begin_inset Formula $^{-1}$
\end_inset

 MeV
\begin_inset Formula $^{-1}$
\end_inset

 steradian
\begin_inset Formula $^{-1}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\phi_{\ell}^{m}\left(\bm{x},E,t\right)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Spherical harmonic moment of the angular flux of degree 
\begin_inset Formula $\ell$
\end_inset

 and order 
\begin_inset Formula $m$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
particles cm
\begin_inset Formula $^{-2}$
\end_inset

 s
\begin_inset Formula $^{-1}$
\end_inset

 MeV
\begin_inset Formula $^{-1}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $v\left(E\right)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Particle speed
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
cm s
\begin_inset Formula $^{-1}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\Sigma_{t}\left(\bm{x},E\right)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Total cross section at position 
\begin_inset Formula $\bm{x}$
\end_inset

 for particles with energy 
\begin_inset Formula $E$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
cm
\begin_inset Formula $^{-1}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\Sigma_{s}\left(\bm{x},\bm{\Omega}'\cdot\bm{\Omega},E'\to E\right)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Scattering cross section at position 
\begin_inset Formula $\bm{x}$
\end_inset

 for particles scattering from direction 
\begin_inset Formula $\bm{\Omega}'$
\end_inset

 to 
\begin_inset Formula $\bm{\Omega}$
\end_inset

 and from energy 
\begin_inset Formula $E'$
\end_inset

 to 
\begin_inset Formula $E$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
MeV
\begin_inset Formula $^{-1}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\chi\left(\bm{x},E\right)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Fission spectrum for energy 
\begin_inset Formula $E$
\end_inset

 for fissions occurring at position 
\begin_inset Formula $\bm{x}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
MeV
\begin_inset Formula $^{-1}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\nu\left(\bm{x},E\right)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Average number of neutrons created in a fission for a neutron at position
 
\begin_inset Formula $\bm{x}$
\end_inset

 and with energy 
\begin_inset Formula $E$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
particles
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\Sigma_{f}\left(\bm{x},E\right)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Fission cross section at position 
\begin_inset Formula $\bm{x}$
\end_inset

 for particles of energy 
\begin_inset Formula $E$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
cm
\begin_inset Formula $^{-1}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $q\left(\bm{x},\bm{\Omega},E,t\right)$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Internal particle source at position 
\begin_inset Formula $\bm{x}$
\end_inset

 in direction 
\begin_inset Formula $\bm{\Omega}$
\end_inset

 with energy 
\begin_inset Formula $E$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
particles cm
\begin_inset Formula $^{-3}$
\end_inset

 s
\begin_inset Formula $^{-1}$
\end_inset

 MeV
\begin_inset Formula $^{-1}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Variables in the transport equation
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Continuous transport equation
\end_layout

\begin_layout Standard
Begin with the neutron transport equation without delayed neutrons,
\begin_inset Formula 
\begin{multline}
\frac{1}{v\left(E\right)}\frac{\partial}{\partial t}\psi\left(\bm{x},\bm{\Omega},E,t\right)+\bm{\Omega}\cdot\bm{\nabla}\psi\left(\bm{x},\bm{\Omega},E,t\right)+\Sigma_{t}\left(\bm{x},E\right)\psi\left(\bm{x},\bm{\Omega},E,t\right)\\
=\int_{0}^{\infty}\int_{4\pi}\Sigma_{s}\left(\bm{x},\bm{\Omega}'\cdot\bm{\Omega},E'\to E\right)\psi\left(\bm{x},\bm{\Omega}',E',t\right)d\Omega'dE'\\
+\chi\left(\bm{x},E\right)\int_{0}^{\infty}\int_{4\pi}\nu\left(\bm{x},E'\right)\Sigma_{f}\left(\bm{x},E'\right)\psi\left(\bm{x},\bm{\Omega}',E',t\right)d\Omega'dE'+q\left(\bm{x},\bm{\Omega},E,t\right),\\
\bm{x}\in V,\quad\bm{\Omega}\in4\pi,\quad0<E<\infty,\quad0<t,
\end{multline}

\end_inset

and the accompanying boundary and initial conditions,
\begin_inset Formula 
\begin{gather}
\psi\left(\bm{x},\bm{\Omega},E,t\right)=\psi^{b}\left(\bm{x},\bm{\Omega},E,t\right)+\rho\psi\left(\bm{x},\bm{\Omega}_{r},E,t\right),\qquad\bm{x}\in V,\quad\bm{\Omega}\cdot\bm{n}<0,\quad0<E<\infty,\quad0<t,\\
\psi\left(\bm{x},\bm{\Omega},E,t=0\right)=\psi^{i}\left(\bm{x},\bm{\Omega},E\right),\qquad\bm{x}\in V,\quad\bm{\Omega}\in4\pi,\quad0<E<\infty.
\end{gather}

\end_inset

Here 
\begin_inset Formula $\rho$
\end_inset

 allows for the albedo boundary condition with 
\begin_inset Formula $\rho=1$
\end_inset

 for a reflective boundary condition and 
\begin_inset Formula $\rho=0$
\end_inset

 for a vacuum boundary condition.
 The reflection angle is 
\begin_inset Formula $\bm{\Omega}_{r}=\bm{\Omega}-2\left(\bm{\Omega}\cdot\bm{n}\right)\bm{n}$
\end_inset

.
 Defining the spherical harmonics moments of the equation as 
\begin_inset Formula 
\begin{equation}
\phi_{\ell}^{m}\left(\bm{x},E,t\right)\equiv\int_{4\pi}Y_{\ell}^{m}\left(\bm{\Omega}\right)\psi\left(\bm{x},\bm{\Omega},E,t\right)d\Omega,
\end{equation}

\end_inset

and using a similar expression for the representation of the scattering
 source,
\begin_inset Formula 
\begin{equation}
\Sigma_{s;\ell}\left(\bm{x},E'\to E\right)\equiv2\pi\int_{-1}^{1}P_{\ell}\left(\mu_{0}\right)\Sigma_{s}\left(\bm{x},\mu_{0},E'\to E\right)d\mu_{0}
\end{equation}

\end_inset

(with the scattering cosine 
\begin_inset Formula $\mu_{0}=\bm{\Omega}'\cdot\bm{\Omega}$
\end_inset

), we get the approximations
\begin_inset Formula 
\begin{gather}
\psi\left(\bm{x},\bm{\Omega},E,t\right)=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}\right)\phi_{\ell}^{m}\left(\bm{x},E,t\right),\label{eq:spherical-harmonic-angular-expansion}\\
\Sigma_{s}\left(\bm{x},\bm{\Omega}'\cdot\bm{\Omega},E'\to E\right)=\sum_{\ell=0}^{\infty}\sum_{m=-\ell}^{\ell}\Sigma_{s,\ell}\left(\bm{x},E\right)Y_{\ell}^{m}\left(\bm{\Omega}\right)Y_{\ell}^{m}\left(\bm{\Omega}'\right)
\end{gather}

\end_inset

(where we have assumed that the 
\begin_inset Formula $Y_{\ell}^{m}$
\end_inset

 are the real spherical harmonic moments).
 Applying these simplifications to the scattering and fission terms gives
 
\begin_inset Formula 
\begin{multline}
\frac{1}{v\left(E\right)}\frac{\partial}{\partial t}\psi\left(\bm{x},\bm{\Omega},E,t\right)+\bm{\Omega}\cdot\bm{\nabla}\psi\left(\bm{x},\bm{\Omega},E,t\right)+\Sigma_{t}\left(\bm{x},E\right)\psi\left(\bm{x},\bm{\Omega},E,t\right)\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}\right)\int_{0}^{\infty}\Sigma_{s;\ell}\left(\bm{x},E'\to E\right)\phi_{\ell}^{m}\left(\bm{x},E',t\right)dE'\\
+\frac{\chi\left(\bm{x},E\right)}{4\pi}\int_{0}^{\infty}\nu\left(\bm{x},E'\right)\Sigma_{f}\left(\bm{x},E'\right)\phi_{0}^{0}\left(\bm{x},E',t\right)dE'+q\left(\bm{x},\bm{\Omega},E,t\right),\\
\bm{x}\in V,\quad\bm{\Omega}\in4\pi,\quad0<E<\infty,\quad0<t.\label{eq:transport-equation}
\end{multline}

\end_inset


\end_layout

\begin_layout Section
Angular, energy and time simplifications to transport equation
\end_layout

\begin_layout Subsection
Multigroup transport equation
\end_layout

\begin_layout Standard
The multigroup approximation begins with a neutron spectrum approximation,
 
\begin_inset Formula $\Psi\left(\bm{x},E\right)$
\end_inset

, with which each of the energy-dependent cross sections is weighted over
 an energy range 
\begin_inset Formula $E\in\left[E_{g},E_{g-1}\right]$
\end_inset

 to get multigroup cross sections, neutron velocities and fission sources,
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset


\begin_inset Formula 
\begin{gather}
\Sigma_{t;g}\left(\bm{x}\right)\equiv\dfrac{\int_{E_{g}}^{E_{g-1}}\Sigma_{t}\left(\bm{x},E\right)\Psi\left(\bm{x},E\right)dE}{\int_{E_{g}}^{E_{g-1}}\Psi\left(\bm{x},E\right)dE},\\
\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\equiv\dfrac{\int_{E_{g}}^{E_{g-1}}\int_{E_{g'}}^{E_{g'-1}}\Sigma_{s;\ell}\left(\bm{x},E'\to E\right)\Psi\left(\bm{x},E'\right)dE'dE}{\int_{E_{g'}}^{E_{g'-1}}\Psi\left(\bm{x},E'\right)dE'},\\
\frac{1}{\nu_{g}\left(\bm{x}\right)}\equiv\dfrac{\int_{E_{g}}^{E_{g-1}}\frac{1}{v\left(E\right)}\Psi\left(\bm{x},E\right)dE}{\int_{E_{g}}^{E_{g-1}}\Psi\left(\bm{x},E\right)dE},\\
\nu\Sigma_{f;g}\left(\bm{x}\right)\equiv\dfrac{\int_{E_{g}}^{E_{g-1}}\nu\left(\bm{x},E\right)\Sigma_{f}\left(\bm{x},E\right)\Psi\left(\bm{x},E\right)dE}{\int_{E_{g}}^{E_{g-1}}\Psi\left(\bm{x},E\right)dE}.
\end{gather}

\end_inset

The multigroup fission spectrum, angular flux and source are defined as
\begin_inset Formula 
\begin{gather}
\chi_{g}\left(\bm{x}\right)\equiv\int_{E_{g}}^{E_{g-1}}\chi\left(\bm{x},E\right)dE,\\
\psi_{g}\left(\bm{x},\bm{\Omega},t\right)\equiv\int_{E_{g}}^{E_{g-1}}\psi\left(\bm{x},\bm{\Omega},E,t\right)dE,\\
q\left(\bm{x},\bm{\Omega},t\right)\equiv\int_{E_{g}}^{E_{g-1}}q\left(\bm{x},\bm{\Omega},E,t\right)dE.
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

Integrate the transport equation over 
\begin_inset Formula $E\in\left[E_{g},E_{g-1}\right]$
\end_inset

, 
\begin_inset Formula 
\begin{multline}
\frac{\partial}{\partial t}\int_{E_{g}}^{E_{g-1}}\frac{1}{v\left(E\right)}\psi\left(\bm{x},\bm{\Omega},E,t\right)dE+\bm{\Omega}\cdot\bm{\nabla}\int_{E_{g}}^{E_{g-1}}\psi\left(\bm{x},\bm{\Omega},E,t\right)dE+\int_{E_{g}}^{E_{g-1}}\Sigma_{t}\left(\bm{x},E\right)\psi\left(\bm{x},\bm{\Omega},E,t\right)dE\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}\right)\int_{E_{g}}^{E_{g-1}}\int_{0}^{\infty}\Sigma_{s;\ell}\left(\bm{x},E'\to E\right)\phi_{\ell}^{m}\left(\bm{x},E',t\right)dE'dE\\
+\int_{E_{g}}^{E_{g-1}}\frac{\chi\left(\bm{x},E\right)}{4\pi}\int_{0}^{\infty}\nu\left(\bm{x},E'\right)\Sigma_{f}\left(\bm{x},E'\right)\phi_{0}^{0}\left(\bm{x},E',t\right)dE'dE+\int_{E_{g}}^{E_{g-1}}q\left(\bm{x},\bm{\Omega},E,t\right)dE,\\
\bm{x}\in V,\quad\bm{\Omega}\in4\pi,\quad g=1,\dots,G,\quad0<t.
\end{multline}

\end_inset

If weighted integrals of the physical data over 
\begin_inset Formula $\psi\left(\bm{x},E\right)$
\end_inset

 are approximately equal to weighted integrals over 
\begin_inset Formula $\psi\left(\bm{x},\bm{\Omega},E,t\right)$
\end_inset

 (e.g.
 for 
\begin_inset Formula $\Sigma_{t}$
\end_inset

,
\begin_inset Formula 
\begin{equation}
\dfrac{\int_{E_{g}}^{E_{g-1}}\Sigma_{t}\left(\bm{x},E\right)\Psi\left(\bm{x},E\right)dE}{\int_{E_{g}}^{E_{g-1}}\Psi\left(\bm{x},E\right)dE}\approx\dfrac{\int_{E_{g}}^{E_{g-1}}\Sigma_{t}\left(\bm{x},E\right)\psi\left(\bm{x},\bm{\Omega},E,t\right)dE}{\int_{E_{g}}^{E_{g-1}}\psi\left(\bm{x},\bm{\Omega},E,t\right)dE}
\end{equation}

\end_inset

must hold), the transport equation can be simplified to 
\begin_inset Formula 
\begin{multline}
\frac{1}{v_{g}\left(\bm{x}\right)}\frac{\partial}{\partial t}\psi_{g}\left(\bm{x},\bm{\Omega},t\right)dE+\bm{\Omega}\cdot\bm{\nabla}\psi_{g}\left(\bm{x},\bm{\Omega},t\right)+\Sigma_{t;g}\left(\bm{x}\right)\psi_{g}\left(\bm{x},\bm{\Omega},t\right)\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}\right)\sum_{g'=1}^{G}\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x},t\right)\\
+\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{0,g'}^{0}\left(\bm{x},t\right)+q_{g}\left(\bm{x},\bm{\Omega},t\right),\\
\bm{x}\in V,\quad\bm{\Omega}\in4\pi,\quad g=1,\dots,G,\quad0<t.\label{eq:multigroup}
\end{multline}

\end_inset

The initial and boundary equations become
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "eq:multigroup-boundary-initial"

\end_inset


\begin_inset Formula 
\begin{gather}
\psi_{g}\left(\bm{x},\bm{\Omega},t\right)=\psi_{g}^{b}\left(\bm{x},\bm{\Omega},t\right)+\rho\psi_{g}\left(\bm{x},\bm{\Omega}_{r},t\right),\qquad\bm{x}\in V,\quad\bm{\Omega}\cdot\bm{n}<0,\quad g=1,\dots,G,\quad0<t,\label{eq:multigroup-boundary}\\
\psi_{g}\left(\bm{x},\bm{\Omega},t=0\right)=\psi_{g}^{i}\left(\bm{x},\bm{\Omega}\right),\qquad\bm{x}\in V,\quad\bm{\Omega}\in4\pi,\quad g=1,\dots,G,\label{eq:multigroup-initial}
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

where the initial and boundary flux have been integrated over each energy
 group 
\begin_inset Formula $g$
\end_inset

.
 
\end_layout

\begin_layout Subsection
Discrete ordinates transport equation
\end_layout

\begin_layout Standard
The discrete-ordinates approximation solves the transport equation along
 particular rays (or ordinates).
 Defining
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset

 
\begin_inset Formula 
\begin{gather}
\psi_{n,g}\left(\bm{x},t\right)\equiv\psi_{g}\left(\bm{x},\bm{\Omega}_{n},t\right),\\
q_{n,g}\left(\bm{x},t\right)\equiv q_{g}\left(\bm{x},\bm{\Omega}_{n},t\right),
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

for each discrete direction 
\begin_inset Formula $\bm{\Omega}_{n}$
\end_inset

, the transport equation becomes
\begin_inset Formula 
\begin{multline}
\frac{1}{v_{g}\left(\bm{x}\right)}\frac{\partial}{\partial t}\psi_{n,g}\left(\bm{x},t\right)dE+\bm{\Omega}_{n}\cdot\bm{\nabla}\psi_{n,g}\left(\bm{x},t\right)+\Sigma_{t;g}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x},t\right)\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{g'=1}^{G}\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x},t\right)\\
+\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{0,g'}^{0}\left(\bm{x},t\right)+q_{n,g}\left(\bm{x},t\right),\\
\bm{x}\in V,\quad n=1,\dots N,\quad g=1,\dots,G,\quad0<t.\label{eq:discrete-ordinates-transport}
\end{multline}

\end_inset

The boundary and initial conditions become
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset


\begin_inset Formula 
\begin{gather}
\psi_{n,g}\left(\bm{x},t\right)=\psi_{n,g}^{b}\left(\bm{x},t\right)+\rho\psi_{n_{r},g}^{b}\left(\bm{x},t\right),\qquad\bm{x}\in V,\quad\bm{\Omega}_{n}\cdot\bm{n}<0,\quad g=1,\dots,G,\quad0<t,\\
\psi_{n,g}\left(\bm{x},t=0\right)=\psi_{n,g}^{i}\left(\bm{x}\right),\qquad\bm{x}\in V,\quad n=1,\dots N,\quad g=1,\dots,G,
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

To facilitate integration, the directions 
\begin_inset Formula $\bm{\Omega}_{n}$
\end_inset

 are chosen as ordinates in a quadrature set which has the property
\begin_inset Formula 
\begin{equation}
\int_{4\pi}f\left(\bm{\Omega}\right)d\Omega\approx\sum_{n=1}^{N}w_{n}f\left(\bm{\Omega}_{n}\right).
\end{equation}

\end_inset

The calculation of the spherical harmonics moments then becomes
\begin_inset Formula 
\begin{equation}
\phi_{\ell,g}^{m}\left(\bm{x},t\right)\equiv\sum_{n=1}^{N}w_{n}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\psi_{n,g}\left(\bm{x},t\right).
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Steady state transport equation
\end_layout

\begin_layout Standard
At steady state, the time derivative in the transport equation goes to zero
 and time dependence is removed elsewhere, giving
\begin_inset Formula 
\begin{multline}
\bm{\Omega}_{n}\cdot\bm{\nabla}\psi_{n,g}\left(\bm{x}\right)+\Sigma_{t;g}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{g'=1}^{G}\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x}\right)\\
+\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{0,g'}^{0}\left(\bm{x}\right)+q_{n,g}\left(\bm{x}\right),\\
\bm{x}\in V,\quad n=1,\dots N,\quad g=1,\dots,G.\label{eq:steady-state-transport}
\end{multline}

\end_inset

The boundary condition simplifies to 
\begin_inset Formula 
\[
\psi_{n,g}\left(\bm{x}\right)=\psi_{n,g}^{b}\left(\bm{x}\right)+\rho\psi_{n_{r},g}\left(\bm{x}\right),\qquad\bm{x}\in V,\quad\bm{\Omega}_{n}\cdot\bm{n}<0,\quad g=1,\dots,G.
\]

\end_inset


\end_layout

\begin_layout Section
Spatial discretization of the transport equation
\end_layout

\begin_layout Subsection
Strong form of the transport equation
\end_layout

\begin_layout Standard
The transport equation can be applied directly to a basis for the angular
 flux, 
\begin_inset Formula 
\begin{gather*}
\psi_{n,g}\left(\bm{x}\right)=\sum_{i=1}^{I}\alpha_{i,n,g}b_{i}\left(\bm{x}\right),
\end{gather*}

\end_inset

to get
\begin_inset Formula 
\begin{multline}
\sum_{i=1}^{I}\left[\bm{\Omega}_{n}\cdot\bm{\nabla}b_{i}\left(\bm{x}\right)+\Sigma_{t;g}\left(\bm{x}\right)b_{i}\left(\bm{x}\right)\right]\alpha_{i,n,g}\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{g'=1}^{G}\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x}\right)\\
+\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{0,g'}^{0}\left(\bm{x}\right)+q_{n,g}\left(\bm{x}\right),\\
\bm{x}\in V,\quad n=1,\dots N,\quad g=1,\dots,G.
\end{multline}

\end_inset

In the strong form, this equation is enforced chosen points 
\begin_inset Formula $\bm{x}_{j}\in V$
\end_inset

 to get 
\begin_inset Formula 
\begin{multline}
\sum_{i=1}^{I}\left[\bm{\Omega}_{n}\cdot\bm{\nabla}b_{i}\left(\bm{x}_{j}\right)+\Sigma_{t;g}\left(\bm{x}_{j}\right)b_{i}\left(\bm{x}_{j}\right)\right]\alpha_{i,n,g}\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{g'=1}^{G}\Sigma_{s;\ell,g'\to g}\left(\bm{x}_{j}\right)\phi_{\ell,g'}^{m}\left(\bm{x}_{j}\right)\\
+\frac{\chi_{g}\left(\bm{x}_{j}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}_{j}\right)\phi_{0,g'}^{0}\left(\bm{x}_{j}\right)+q_{n,g}\left(\bm{x}_{j}\right),\\
j=1,\dots,J,\quad n=1,\dots N,\quad g=1,\dots,G.\label{eq:strong-discretized-transport}
\end{multline}

\end_inset


\end_layout

\begin_layout Subsection
Weak form of the transport equation
\end_layout

\begin_layout Standard
Multiply the steady-state transport equation by a series of weight functions
 
\begin_inset Formula $w_{j}\left(\bm{x}\right)$
\end_inset

 (for 
\begin_inset Formula $j=1,\dots,J$
\end_inset

) and integrate over the region of support 
\begin_inset Formula $V_{j}$
\end_inset

 of 
\begin_inset Formula $w_{j}\left(\bm{x}\right)$
\end_inset

 to get 
\begin_inset Formula 
\begin{multline}
\int_{V_{j}}w_{j}\left(\bm{x}\right)\bm{\Omega}_{n}\cdot\bm{\nabla}\psi_{n,g}\left(\bm{x}\right)dV+\int_{V_{j}}w_{j}\left(\bm{x}\right)\Sigma_{t;g}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)dV\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{g'=1}^{G}\int_{V_{j}}w_{j}\left(\bm{x}\right)\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x}\right)dV\\
+\int_{V_{j}}w_{j}\left(\bm{x}\right)\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{0,g'}^{0}\left(\bm{x}\right)dV+\int_{V_{j}}w_{j}\left(\bm{x}\right)q_{n,g}\left(\bm{x}\right)dV,\\
j=1,\dots,J,\quad n=1,\dots N,\quad g=1,\dots,G.\label{eq:initial-integral}
\end{multline}

\end_inset

Perform integration by parts on the streaming term and apply the divergence
 theorem
\begin_inset Formula 
\begin{equation}
\int_{V}\bm{\nabla}\cdot\bm{F}\left(\bm{x}\right)dV=\int_{S}\bm{n}\cdot\bm{F}\left(\bm{x}\right)dS
\end{equation}

\end_inset

to get the weak form of the transport equation,
\begin_inset Formula 
\begin{multline}
\int_{S_{j}}\left(\bm{\Omega}_{n}\cdot\bm{n}\right)\psi_{n,g}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS-\int_{V_{j}}\psi_{n,g}\left(\bm{x}\right)\left[\bm{\Omega}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]dV+\int_{V_{j}}w_{j}\left(\bm{x}\right)\Sigma_{t;g}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)dV\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{g'=1}^{G}\int_{V_{j}}w_{j}\left(\bm{x}\right)\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x}\right)dV\\
+\int_{V_{j}}w_{j}\left(\bm{x}\right)\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{0,g'}^{0}\left(\bm{x}\right)dV+\int_{V_{j}}w_{j}\left(\bm{x}\right)q_{n,g}\left(\bm{x}\right)dV,\\
j=1,\dots,J,\quad n=1,\dots N,\quad g=1,\dots,G.
\end{multline}

\end_inset

The surface integral can be split into its unknown and known parts (the
 boundary condition) to give
\begin_inset Formula 
\begin{multline}
\int_{\bm{\Omega}_{n}\cdot\bm{n}>0}\left(\bm{\Omega}_{n}\cdot\bm{n}\right)\psi_{n,g}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS-\int_{V_{j}}\psi_{n,g}\left(\bm{x}\right)\left[\bm{\Omega}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]dV+\int_{V_{j}}w_{j}\left(\bm{x}\right)\Sigma_{t;g}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)dV\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{g'=1}^{G}\int_{V_{j}}w_{j}\left(\bm{x}\right)\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x}\right)dV\\
+\int_{V_{j}}w_{j}\left(\bm{x}\right)\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{0,g'}^{0}\left(\bm{x}\right)dV+\int_{\bm{\Omega}_{n}\cdot\bm{n}<0}\left|\bm{\Omega}_{n}\cdot\bm{n}\right|\psi_{n,g}^{b}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS\\
+\int_{V_{j}}w_{j}\left(\bm{x}\right)q_{n,g}\left(\bm{x}\right)dV\\
j=1,\dots,J,\quad n=1,\dots N,\quad g=1,\dots,G.\label{eq:continuous-xs-transport}
\end{multline}

\end_inset

If the cross sections are constant within each support region 
\begin_inset Formula $V_{j}$
\end_inset

, (
\begin_inset Formula $\Sigma_{j}=\Sigma\left(\bm{x}\right)$
\end_inset

 for all 
\begin_inset Formula $\bm{x}\in V_{j}$
\end_inset

) this simplifies to 
\begin_inset Formula 
\begin{multline}
\int_{\bm{\Omega}_{n}\cdot\bm{n}>0}\left(\bm{\Omega}_{n}\cdot\bm{n}\right)\psi_{n,g}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS-\int_{V_{j}}\psi_{n,g}\left(\bm{x}\right)\left[\bm{\Omega}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]dV+\Sigma_{t;j,g}\int_{V_{j}}w_{j}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)dV\\
=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{g'=1}^{G}\Sigma_{s;j,\ell,g'\to g}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x}\right)dV\\
+\frac{\chi_{j,g}}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;j,g'}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{0,g'}^{0}\left(\bm{x}\right)dV+\int_{\bm{\Omega}_{n}\cdot\bm{n}<0}\left|\bm{\Omega}_{n}\cdot\bm{n}\right|\psi_{n,g}^{b}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS\\
+\int_{V_{j}}w_{j}\left(\bm{x}\right)q_{n,g}\left(\bm{x}\right)dV,\\
j=1,\dots,J,\quad n=1,\dots N,\quad g=1,\dots,G.\label{eq:constant-xs-transport}
\end{multline}

\end_inset


\end_layout

\begin_layout Subsection
Conservation of neutrons
\end_layout

\begin_layout Standard
Without loss of generality, the weak form of the transport equation can
 be written as
\begin_inset Formula 
\begin{multline}
\int_{\bm{\Omega}_{n}\cdot\bm{n}>0}\left(\bm{\Omega}_{n}\cdot\bm{n}\right)\psi_{n,g}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS-\int_{V_{j}}\psi_{n,g}\left(\bm{x}\right)\left[\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]dV+\int_{V_{j}}\Sigma_{t;g}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)dV\\
=\int_{V_{j}}w_{j}\left(\bm{x}\right)s_{n,g}\left(\bm{x}\right)dV+\int_{\bm{\Omega}_{n}\cdot\bm{n}<0}\left|\bm{\Omega}_{n}\cdot\bm{n}\right|\psi_{n,g}^{b}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS,\\
j=1,\dots,J,\quad n=1,\dots N,\quad g=1,\dots,G,\label{eq:simplified-lhs}
\end{multline}

\end_inset

where
\begin_inset Formula 
\begin{multline}
s_{n,g}\left(\bm{x}\right)=\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{g'=1}^{G}\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x}\right)\\
+\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{0,g'}^{0}\left(\bm{x}\right)+q_{n,g}\left(\bm{x}\right).\label{eq:total-source}
\end{multline}

\end_inset

Multiply the transport equation by an arbitrary constant 
\begin_inset Formula $c_{j}$
\end_inset

 and sum over all 
\begin_inset Formula $j$
\end_inset

 to get
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{multline}
\int_{\bm{\Omega}_{n}\cdot\bm{n}>0}\left(\bm{\Omega}_{n}\cdot\bm{n}\right)\psi_{n,g}\left(\bm{x}\right)\left(\sum_{j=1}^{J}c_{j}w_{j}\left(\bm{x}\right)\right)dS-\int_{V}\psi_{n,g}\left(\bm{x}\right)\left[\bm{\Omega}_{n}\cdot\bm{\nabla}\left(\sum_{j=1}^{J}c_{j}w_{j}\left(\bm{x}\right)\right)\right]dV\\
+\int_{V}\Sigma_{t;g}\left(\bm{x}\right)\left(\sum_{j=1}^{J}c_{j}w_{j}\left(\bm{x}\right)\right)\psi_{n,g}\left(\bm{x}\right)dV\\
=\int_{V}\left(\sum_{j=1}^{J}c_{j}w_{j}\left(\bm{x}\right)\right)s_{n,g}\left(\bm{x}\right)dV+\int_{\bm{\Omega}_{n}\cdot\bm{n}<0}\left|\bm{\Omega}_{n}\cdot\bm{n}\right|\psi_{n,g}^{b}\left(\bm{x}\right)\left(\sum_{j=1}^{J}c_{j}w_{j}\left(\bm{x}\right)\right)dS,\\
n=1,\dots N,\quad g=1,\dots,G.
\end{multline}

\end_inset

Suppose that there exist 
\begin_inset Formula $c_{j}$
\end_inset

 such that 
\begin_inset Formula 
\begin{equation}
\sum_{j}c_{j}w_{j}\left(\bm{x}\right)=1.\label{eq:sum-weight}
\end{equation}

\end_inset

Then using these 
\begin_inset Formula $c_{j}$
\end_inset

, we get that the weak form of the transport equations satisfy 
\begin_inset Formula 
\begin{multline}
\int_{\bm{\Omega}_{n}\cdot\bm{n}>0}\left(\bm{\Omega}_{n}\cdot\bm{n}\right)\psi_{n,g}\left(\bm{x}\right)dS-\int_{\bm{\Omega}_{n}\cdot\bm{n}<0}\left|\bm{\Omega}_{n}\cdot\bm{n}\right|\psi_{n,g}^{b}\left(\bm{x}\right)dS=\int_{V}s_{n,g}\left(\bm{x}\right)dV-\int_{V}\Sigma_{t,g}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)dV,\\
n=1,\dots N,\quad g=1,\dots,G.
\end{multline}

\end_inset

This statement of conservation can also be directly derived by integrating
 the transport equation over 
\begin_inset Formula $V$
\end_inset

.
 It states that the neutrons entering the problem minus the neutrons exiting
 the problem equal the gains from the internal source, scattering and fission
 plus the losses from absorption.
 Thus, it is a sufficient condition for conservation that Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:sum-weight"

\end_inset

 holds true for some 
\begin_inset Formula $c_{j}$
\end_inset

.
 
\end_layout

\begin_layout Subsection
Petrov-Galerkin method
\end_layout

\begin_layout Standard
The Petrov-Galerkin method can supply the unknowns needed to solve the weak
 form of the transport equation.
 Defining
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset


\begin_inset Formula 
\begin{gather}
\psi_{n,g}\left(\bm{x}\right)=\sum_{i=1}^{J}\alpha_{i,n,g}b_{i}\left(\bm{x}\right),\\
\phi_{\ell,g}^{m}\left(\bm{x}\right)=\sum_{n=1}^{N}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{i=1}^{J}\alpha_{i,n,g}b_{i}\left(\bm{x}\right)=\sum_{i=1}^{J}\beta_{i,\ell,g}^{m}b_{i}\left(\bm{x}\right),\label{eq:moments-expansion}\\
\psi_{n,g}^{b}\left(\bm{x}\right)=\sum_{i=1}^{J}\alpha_{i,n,g}^{b}b_{i}\left(\bm{x}\right),
\end{gather}

\end_inset

as the basis, the weak form of the transport equation becomes
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset


\begin_inset Formula 
\begin{multline}
\sum_{i=1}^{J}\left[\int_{\bm{\Omega}_{n}\cdot\bm{n}>0}\left(\bm{\Omega}_{n}\cdot\bm{n}\right)b_{i}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS-\int_{V_{j}}b_{i}\left(\bm{x}\right)\left[\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]dV+\Sigma_{t;j,g}\int_{V_{j}}b_{i}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV\right]\alpha_{i,n,g}\\
=\sum_{\ell}\frac{2\ell+1}{4\pi}\sum_{m}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\sum_{g'}\Sigma_{s;j,\ell,g'\to g}\sum_{i=1}^{J}\beta_{i,\ell,g'}^{m}\int_{V_{j}}b_{i}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV\\
+\frac{\chi_{j,g}}{4\pi}\sum_{g'}\nu\Sigma_{f;j,g'}\sum_{i=1}^{J}\beta_{i,0,g'}^{0}\int_{V_{j}}b_{i}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV+\sum_{i=1}^{J}\alpha_{i,n,g}^{b}\int_{\bm{\Omega}_{n}\cdot\bm{n}<0}\left|\bm{\Omega}_{n}\cdot\bm{n}\right|b_{i}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS\\
+\int_{V_{j}}w_{j}\left(\bm{x}\right)q_{n,g}\left(\bm{x}\right)dV,\\
j=1,\dots,J,\quad n=1,\dots N,\quad g=1,\dots,G.\label{eq:petrov-galerkin}
\end{multline}

\end_inset

Thus, the integrands become functions of the known 
\begin_inset Formula $b_{i}$
\end_inset

, 
\begin_inset Formula $w_{j}$
\end_inset

, and 
\begin_inset Formula $q_{n,g}$
\end_inset

.
 If 
\begin_inset Formula $b_{i}=w_{i}$
\end_inset

 for all 
\begin_inset Formula $i$
\end_inset

, this is the Galerkin method, which is frequently used in the finite element
 method.
 If the basis and weight function differ, it is the Petrov-Galerkin method.
 Note that the relationship between the 
\begin_inset Formula $\alpha_{i,n,g}$
\end_inset

 and 
\begin_inset Formula $\beta_{i,\ell,g}^{m}$
\end_inset

 is exactly the same as 
\begin_inset Formula $\psi_{n,g}$
\end_inset

 and 
\begin_inset Formula $\phi_{\ell,g}^{m}$
\end_inset

:
\begin_inset Formula 
\begin{equation}
\beta_{i,\ell,g}^{m}=\sum_{n=1}^{N}w_{n}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\alpha_{i,n,g}.\label{eq:coefficient-relation}
\end{equation}

\end_inset

This allows the same code that is used to convert between the angular flux
 and its moments to do the same for 
\begin_inset Formula $\alpha$
\end_inset

 and 
\begin_inset Formula $\beta$
\end_inset

.
 The boundary source term is written in a form that allows easy reflection
 without interpolation.
 If instead of reflection the boundary source is intrinsic to the problem,
 the boundary source itself could be used in the integrand.
 
\end_layout

\begin_layout Subsection
Streamline upwind Petrov-Galerkin method
\end_layout

\begin_layout Standard
The streamline upwind Petrov-Galerkin (SUPG) method can be used to stabilize
 the solution of the transport equation when a continuous method (such as
 the CFEM, or continuous finite element method) is used.
 In these methods, the solution does not allow discontinuities.
 Because the transport equation is mathematically an advection equation,
 this causes instabilities that manifest in oscillations.
 The SUPG method adds artificial diffusion into the problem without affecting
 overall particle balance.
 Using the definition of 
\begin_inset Formula $s_{n,g}$
\end_inset

 in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:total-source"

\end_inset

, the weak form of the transport equation before integration by parts is
\begin_inset Formula 
\begin{multline}
\int_{V_{j}}w_{j}\left(\bm{x}\right)\left[\bm{\Omega}_{n}\cdot\bm{\nabla}\psi_{n,g}\left(\bm{x}\right)\right]dV+\int_{V_{j}}\Sigma_{t;g}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)dV\\
=\int_{V_{j}}w_{j}\left(\bm{x}\right)s_{n,g}\left(\bm{x}\right)dV,\\
j=1,\dots,J,\quad n=1,\dots N,\quad g=1,\dots,G,
\end{multline}

\end_inset

If instead of using the weight function 
\begin_inset Formula $w_{j}\left(\bm{x}\right)$
\end_inset

 we used as a weight function 
\begin_inset Formula $\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)$
\end_inset

, this equation would become 
\begin_inset Formula 
\begin{multline}
\int_{V_{j}}\left[\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]\left[\bm{\Omega}_{n}\cdot\bm{\nabla}\psi_{n,g}\left(\bm{x}\right)\right]dV+\int_{V_{j}}\Sigma_{t;g}\left(\bm{x}\right)\left[\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]\psi_{n,g}\left(\bm{x}\right)dV\\
=\int_{V_{j}}\left[\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]s_{n,g}\left(\bm{x}\right)dV,\\
j=1,\dots,J,\quad n=1,\dots N,\quad g=1,\dots,G,
\end{multline}

\end_inset

Adding this equation to Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:simplified-lhs"

\end_inset

 gives the SUPG form of the transport equation,
\begin_inset Formula 
\begin{multline}
\int_{\bm{\Omega}_{n}\cdot\bm{n}>0}\left(\bm{\Omega}_{n}\cdot\bm{n}\right)\psi_{n,g}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS+\int_{V_{j}}\left[\psi_{n,g}\left(\bm{x}\right)+\bm{\Omega}_{n}\cdot\bm{\nabla}\psi_{n,g}\left(\bm{x}\right)\right]\left[\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]dV\\
+\int_{V_{j}}\Sigma_{t;g}\left(\bm{x}\right)\left[w_{j}\left(\bm{x}\right)+\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]\psi_{n,g}\left(\bm{x}\right)dV\\
=\int_{V_{j}}\left[w_{j}\left(\bm{x}\right)+\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]s_{n,g}\left(\bm{x}\right)dV+\int_{\bm{\Omega}_{n}\cdot\bm{n}<0}\left|\bm{\Omega}_{n}\cdot\bm{n}\right|\psi_{n,g}^{b}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dS,\\
j=1,\dots,J,\quad n=1,\dots N,\quad g=1,\dots,G,\label{eq:SUPG-equation}
\end{multline}

\end_inset

Notably, this addition does not affect particle balance if Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:sum-weight"

\end_inset

 holds as before, as the derivatives will annihilate the constant, giving
 
\begin_inset Formula $0=0$
\end_inset

 for the SUPG addition when multiplied by 
\begin_inset Formula $c_{j}$
\end_inset

 and summed over all 
\begin_inset Formula $j$
\end_inset

.
 The reason this term stabilizes the method can be found in the volume integral
 of the streaming term.
 If we had a diffusion method with diffusion tensor 
\begin_inset Formula $\bm{D}=\bm{\Omega}_{n}\bm{\Omega}_{n}$
\end_inset

,
\begin_inset Formula 
\begin{equation}
-\left(\bm{\Omega}_{n}\cdot\bm{\nabla}\right)\left(\bm{\Omega}_{n}\cdot\bm{\nabla}\right)f\left(\bm{x}\right)=-\bm{\nabla}\cdot\left(\bm{D}\cdot\bm{\nabla}\right)f\left(\bm{x}\right)=0,
\end{equation}

\end_inset

 the weak form of the equation would be 
\begin_inset Formula 
\begin{equation}
-\int_{S_{j}}\left[\bm{n}\cdot\left(\bm{D}\cdot\bm{\nabla}\right)f\left(\bm{x}\right)\right]w_{j}\left(\bm{x}\right)+\int_{V_{j}}\left[\bm{\Omega}_{n}\cdot\bm{\nabla}f\left(\bm{x}\right)\right]\left[\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\left(\bm{x}\right)\right]dV=0.\label{eq:weak-supg-diffusion-comp}
\end{equation}

\end_inset

The diffusive term in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:weak-supg-diffusion-comp"

\end_inset

 can be found in the SUPG addition in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:SUPG-equation"

\end_inset

.
 This adds numerical diffusion (and stabilization) to the method.
 
\end_layout

\begin_layout Subsection
Spatially-dependent cross sections
\end_layout

\begin_layout Standard
THINK ABOUT HOW TO HANDLE SPHERICAL HARMONIC MOMENTS OF 
\begin_inset Formula $\Sigma_{s}$
\end_inset

: DEPENDS ON 
\begin_inset Formula $m$
\end_inset


\end_layout

\begin_layout Standard
Suppose that the assumption made after Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:continuous-xs-transport"

\end_inset

 that the cross sections are continuous does not hold.
 The integrals over weight and basis functions would then have to be done
 for each group and cross section as well.
 To avoid this, some approximation of the moments of the angular flux 
\begin_inset Formula $\Phi_{\ell,g}^{m}\left(\bm{x}\right)$
\end_inset

 (from a low-order 
\begin_inset Formula $P_{N}$
\end_inset

 or 
\begin_inset Formula $SP_{N}$
\end_inset

 calculation, for instance) can be used to weight the cross sections and
 remove them from the integrals.
 Define
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset


\begin_inset Formula 
\begin{gather}
\Sigma_{t;j,g}\equiv\dfrac{\int_{V_{j}}\Sigma_{t;g}\left(\bm{x}\right)\Phi_{0,g}^{0}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}{\int_{V_{j}}\Phi_{0,g}^{0}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV},\label{eq:total-xs-weighting}\\
\Sigma_{s;j,\ell,g'\to g}\equiv\dfrac{\int_{V_{j}}\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\Phi_{\ell,g'}^{m}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}{\int_{V_{j}}\Phi_{\ell,g'}^{m}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV},\\
\chi_{j,g}\equiv\dfrac{\int_{V_{j}}\chi_{g}\left(\bm{x}\right)\sum_{g'}\left[\nu\Sigma_{f;g'}\Phi_{0,g'}^{0}\left(\bm{x}\right)\right]w_{j}\left(\bm{x}\right)dV}{\int_{V_{j}}\sum_{g'}\left[\nu\Sigma_{f;g'}\Phi_{0,g'}^{0}\left(\bm{x}\right)\right]w_{j}\left(\bm{x}\right)dV},\\
\nu\Sigma_{f;j,g}\equiv\dfrac{\int_{V_{j}}\nu\Sigma_{f;g}\left(\bm{x}\right)\Phi_{0,g}^{0}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}{\int_{V_{j}}\Phi_{0,g}^{0}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV},
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

(noting that the fission spectrum is weighted by the fission source) and
 assume that
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset

 
\begin_inset Formula 
\begin{gather}
\phi_{0,g}^{0}\left(\bm{x}\right)\sim\psi_{n,g}\left(\bm{x}\right)\text{ for all }n,g,\label{eq:isotropic-assumption}\\
\Phi_{\ell,g}^{m}\sim\phi_{\ell,g}^{m}\text{ for all }\ell,m,g.
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

Then the approximations can be made that
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset

 
\begin_inset Formula 
\begin{multline}
\int_{V_{j}}w_{j}\left(\bm{x}\right)\Sigma_{t,g}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)dV\\
\approx\dfrac{\int_{V_{j}}\Sigma_{t;g}\left(\bm{x}\right)\Phi_{0,g}^{0}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}{\int_{V_{j}}\Phi_{0,g}^{0}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}\int_{V_{j}}w_{j}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)dV\\
=\Sigma_{t;j,g}\int_{V_{j}}w_{j}\left(\bm{x}\right)\psi_{n,g}\left(\bm{x}\right)dV,
\end{multline}

\end_inset


\begin_inset Formula 
\begin{multline}
\int_{V_{j}}w_{j}\left(\bm{x}\right)\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x}\right)dV\\
\approx\dfrac{\int_{V_{j}}\Sigma_{s;\ell,g'\to g}\left(\bm{x}\right)\Phi_{\ell,g'}^{m}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}{\int_{V_{j}}\Phi_{\ell,g'}^{m}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x}\right)dV\\
=\Sigma_{s;j,\ell,g'\to g}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{\ell,g'}^{m}\left(\bm{x}\right)dV,
\end{multline}

\end_inset


\begin_inset Formula 
\begin{multline}
\int_{V_{j}}w_{j}\left(\bm{x}\right)\chi_{g}\left(\bm{x}\right)\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{0,g'}^{0}\left(\bm{x}\right)dV\\
\approx\dfrac{\int_{V_{j}}\chi_{g}\left(\bm{x}\right)\sum_{g''}\left[\nu\Sigma_{f;g''}\Phi_{0,g''}^{0}\left(\bm{x}\right)\right]w_{j}\left(\bm{x}\right)dV}{\int_{V_{j}}\sum_{g''}\left[\nu\Sigma_{f;g''}\Phi_{0,g''}^{0}\left(\bm{x}\right)\right]w_{j}\left(\bm{x}\right)dV}\sum_{g'=1}^{G}\dfrac{\int_{V_{j}}\nu\Sigma_{f;g'}\left(\bm{x}\right)\Phi_{0,g'}^{0}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}{\int_{V_{j}}\Phi_{0,g'}^{0}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}\int_{V_{j}}\phi_{0,g'}^{0}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV\\
=\chi_{g,j}\sum_{g'=1}^{G}\nu\Sigma_{f;j,g'}\int_{V_{j}}\phi_{0,g'}^{0}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV.
\end{multline}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
If instead of using only the first spherical harmonic moment of the angular
 flux in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:total-xs-weighting"

\end_inset

 a more complete weighting using the spherical harmonic expansion (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:spherical-harmonic-angular-expansion"

\end_inset

) were used, the approximation would be instead 
\begin_inset Formula 
\begin{equation}
\Sigma_{t;j,g,n}\equiv\dfrac{\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\int_{V_{j}}\Sigma_{t;g}\left(\bm{x}\right)\Phi_{\ell,g}^{m}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}{\sum_{\ell=0}^{\infty}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\int_{V_{j}}\Phi_{\ell,g}^{m}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV}.
\end{equation}

\end_inset

This approximation would be truncated to some finite value of 
\begin_inset Formula $\ell$
\end_inset

.
 The values for each 
\begin_inset Formula $n$
\end_inset

 could be calculated as needed and would not need to be stored.
 This would increase the number of integrals, but not significantly when
 compared, for instance, to the number required for the scattering cross
 section.
 
\end_layout

\begin_layout Part
Spatial approximations to the transport equation
\end_layout

\begin_layout Section
Derivation of the diffusion equations
\end_layout

\begin_layout Subsection
From spatially continuous transport equations
\end_layout

\begin_layout Standard
In this derivation, 
\begin_inset Formula $\phi_{g}$
\end_inset

 will be the multigroup isotropic moment of the angular flux, while 
\begin_inset Formula $\bm{J}$
\end_inset

 will be the multigroup current.
 These are defined in terms of the spherical harmonic moments as as
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset


\begin_inset Formula 
\begin{gather}
\phi_{g}\equiv\phi_{0,g}^{0},\\
\bm{J}_{g}\equiv\left[\phi_{1,g}^{0},\phi_{1,g}^{1},\phi_{1,g}^{-1}\right].
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

The linearly anisotropic (or first-order) flux approximation can then be
 written 
\begin_inset Formula 
\begin{align}
\psi_{g}\left(\bm{x},\bm{\Omega},t\right) & \approx\sum_{\ell=0}^{1}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}\phi_{\ell}^{m}\left(\bm{x},t\right)Y_{\ell}^{m}\left(\bm{\Omega}\right)d\Omega\nonumber \\
 & =\frac{1}{4\pi}\left[\phi_{g}\left(\bm{x},t\right)+3\bm{\Omega}\cdot\bm{J}_{g}\left(\bm{x},t\right)\right].
\end{align}

\end_inset

We also define the zeroth and first order sources as
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset

 
\begin_inset Formula 
\begin{gather*}
Q_{0,g}\left(\bm{x},t\right)\equiv\frac{1}{4\pi}\int_{4\pi}q_{g}\left(\bm{x},\bm{\Omega},t\right)d\Omega,\\
\bm{Q}_{1,g}\left(\bm{x},t\right)\equiv\frac{1}{4\pi}\int_{4\pi}\bm{\Omega}q_{g}\left(\bm{x},\bm{\Omega},t\right)d\Omega.
\end{gather*}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

Beginning from the multigroup, continuous-energy and space equation (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:multigroup"

\end_inset

) with its accompanying boundary and initial conditions (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:multigroup-boundary-initial"

\end_inset

), perform 
\begin_inset Formula $\int_{4\pi}\left(\cdot\right)d\Omega$
\end_inset

 and 
\begin_inset Formula $\int_{4\pi}\bm{\Omega}\left(\cdot\right)d\Omega$
\end_inset

 individually to get
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{multline}
\frac{1}{v_{g}\left(\bm{x}\right)}\frac{\partial}{\partial t}\phi_{g}\left(\bm{x}\right)+\bm{\nabla}\cdot\bm{J}_{g}\left(\bm{x},t\right)+\Sigma_{t;g}\left(\bm{x}\right)\phi_{g}\left(\bm{x}\right)\\
=\sum_{g'=1}^{G}\Sigma_{s;0,g'\to g}\left(\bm{x}\right)\phi_{g'}\left(\bm{x},t\right)+\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{g'}\left(\bm{x},t\right)+Q_{0,g}\left(\bm{x},t\right),\\
\bm{x}\in V,\quad g=1,\dots,G,\quad0<t,\label{eq:p1-phi}
\end{multline}

\end_inset


\begin_inset Formula 
\begin{multline}
\frac{1}{v_{g}\left(\bm{x}\right)}\frac{\partial}{\partial t}\bm{J}_{g}\left(\bm{x}\right)+\frac{1}{3}\bm{\nabla}\phi_{g}\left(\bm{x},t\right)+\Sigma_{t;g}\left(\bm{x}\right)\bm{J}_{g}\left(\bm{x}\right)\\
=\sum_{g'=1}^{G}\Sigma_{s;1,g'\to g}\left(\bm{x}\right)\bm{J}_{g'}\left(\bm{x},t\right),\\
\bm{x}\in V,\quad g=1,\dots,G,\quad0<t.\label{eq:p1-j}
\end{multline}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

Neglect time derivative on 
\begin_inset Formula $\bm{J}$
\end_inset

 and assume that 
\begin_inset Formula 
\begin{equation}
\sum_{g'=1}^{G}\Sigma_{s;1,g'\to g}\left(\bm{x}\right)\bm{J}_{g'}\left(\bm{x},t\right)\approx\bm{J}_{g}\left(\bm{x},t\right)\sum_{g'=1}^{G}\Sigma_{s;1,g'\to g}
\end{equation}

\end_inset

(i.e.
 the energy and direction of scattering are independent) to get Fick's Law,
\begin_inset Formula 
\begin{equation}
\bm{J}_{g}\left(\bm{x},t\right)\approx-D_{g}\left(\bm{x}\right)\bm{\nabla}\phi_{g}\left(\bm{x},t\right),\label{eq:ficks-law}
\end{equation}

\end_inset

with
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset

 
\begin_inset Formula 
\begin{gather}
\Sigma_{tr;g}\left(\bm{x}\right)\equiv\Sigma_{t;g}\left(\bm{x}\right)-\sum_{g'=1}^{G}\Sigma_{s;1,g'\to g},\\
D_{g}\left(\bm{x}\right)\equiv\frac{1}{3\Sigma_{tr;g}\left(\bm{x}\right)}.
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

Then the multigroup diffusion equation is
\begin_inset Formula 
\begin{multline}
\frac{1}{v_{g}\left(\bm{x}\right)}\frac{\partial}{\partial t}\phi_{g}\left(\bm{x},t\right)-\bm{\nabla}\cdot D_{g}\left(\bm{x}\right)\bm{\nabla}\phi_{g}\left(\bm{x},t\right)+\Sigma_{t;g}\left(\bm{x}\right)\phi_{g}\left(\bm{x},t\right)\\
=\sum_{g'=1}^{G}\Sigma_{s;0,g'\to g}\left(\bm{x}\right)\phi_{g'}\left(\bm{x},t\right)+\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{g'}\left(\bm{x},t\right)+Q_{0,g}\left(\bm{x},t\right),\\
\bm{x}\in V,\quad g=1,\dots,G,\quad0<t.\label{eq:multigroup-diffusion}
\end{multline}

\end_inset

For the boundary condition, start by defining incoming and outgoing partial
 currents,
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset


\begin_inset Formula 
\begin{gather}
J_{g}^{-}\left(\bm{x},t\right)\equiv\int_{\bm{\Omega}\cdot\bm{n}<0}\left|\bm{\Omega}\cdot\bm{n}\right|\psi_{g}\left(\bm{x},\bm{\Omega},t\right)d\Omega,\\
J_{g}^{+}\left(\bm{x},t\right)\equiv\int_{\bm{\Omega}\cdot\bm{n}>0}\bm{\Omega}\cdot\bm{n}\psi_{g}\left(\bm{x},\bm{\Omega},t\right)d\Omega,
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

, and using the linearly anisotropic assumption to get
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "eq:partial-currents"

\end_inset


\begin_inset Formula 
\begin{gather}
J_{g}^{-}\left(\bm{x},t\right)\approx-\frac{1}{4\pi}\bm{n}\cdot\left[\int_{\bm{\Omega}\cdot\bm{n}<0}\bm{\Omega}\phi_{g}\left(\bm{x},t\right)+3\bm{\Omega}\bm{\Omega}\cdot\bm{J}_{g}\left(\bm{x},t\right)d\Omega\right]=\frac{1}{4}\left[\phi_{g}\left(\bm{x},t\right)-2\bm{n}\cdot\bm{J}_{g}\left(\bm{x},t\right)\right],\\
J_{g}^{+}\left(\bm{x},t\right)\approx\frac{1}{4\pi}\bm{n}\cdot\left[\int_{\bm{\Omega}\cdot\bm{n}>0}\bm{\Omega}\phi_{g}\left(\bm{x},t\right)+3\bm{\Omega}\bm{\Omega}\cdot\bm{J}_{g}\left(\bm{x},t\right)d\Omega\right]=\frac{1}{4}\left[\phi_{g}\left(\bm{x},t\right)+2\bm{n}\cdot\bm{J}_{g}\left(\bm{x},t\right)\right].
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

Apply Fick's Law to get these in terms of the scalar flux,
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "eq:partial-currents-flux"

\end_inset


\begin_inset Formula 
\begin{gather}
J_{g}^{-}\left(\bm{x},t\right)=\frac{1}{4}\left[\phi_{g}\left(\bm{x},t\right)+2D_{g}\left(\bm{x}\right)\bm{n}\cdot\bm{\nabla}\phi_{g}\left(\bm{x},t\right)\right],\\
J_{g}^{+}\left(\bm{x},t\right)=\frac{1}{4}\left[\phi_{g}\left(\bm{x},t\right)-2D_{g}\left(\bm{x}\right)\bm{n}\cdot\bm{\nabla}\phi_{g}\left(\bm{x},t\right)\right].
\end{gather}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset

Multiply Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:multigroup-boundary"

\end_inset

 by 
\begin_inset Formula $\left|\bm{\Omega}\cdot\bm{n}\right|$
\end_inset

 and integrate over those directions with 
\begin_inset Formula $\bm{\Omega}\cdot\bm{n}<0$
\end_inset

 to get
\begin_inset Formula 
\begin{equation}
J_{g}^{-}\left(\bm{x},t\right)=J_{g}^{b-}\left(\bm{x},t\right)+\rho J_{g}^{+}\left(\bm{x},t\right).\label{eq:diffusion-current-boundary}
\end{equation}

\end_inset

This can be simplified further by using the definition of 
\begin_inset Formula $\bm{J}$
\end_inset

 in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ficks-law"

\end_inset

 to get the diffusion boundary condition,
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{subequations}
\end_layout

\end_inset

 
\begin_inset Formula 
\begin{equation}
\frac{1}{4}\left[\left(1-\rho\right)\phi_{g}\left(\bm{x},t\right)+2\left(1+\rho\right)D_{g}\left(\bm{x}\right)\bm{n}\cdot\bm{\nabla}\phi_{g}\left(\bm{x},t\right)\right]=J_{g}^{b-}\left(\bm{x},t\right).
\end{equation}

\end_inset

The initial condition can be found by performing 
\begin_inset Formula $\int_{4\pi}\left(\cdot\right)d\Omega$
\end_inset

 on the initial condition (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:multigroup-initial"

\end_inset

) to get
\begin_inset Formula 
\begin{equation}
\phi_{g}\left(\bm{x},0\right)=\int_{4\pi}\psi_{g}^{i}\left(\bm{x},t\right)d\Omega\equiv\phi_{g}^{i}\left(\bm{x},t\right).
\end{equation}

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{subequations}
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Steady-state
\end_layout

\begin_layout Standard
For the steady-state diffusion equation, set the time derivative in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:multigroup-diffusion"

\end_inset

 to zero and remove time dependence in the unknowns to get
\begin_inset Formula 
\begin{multline}
-\bm{\nabla}\cdot D_{g}\left(\bm{x}\right)\bm{\nabla}\phi_{g}\left(\bm{x}\right)+\Sigma_{t;g}\left(\bm{x}\right)\phi_{g}\left(\bm{x}\right)\\
=\sum_{g'=1}^{G}\Sigma_{s;0,g'\to g}\left(\bm{x}\right)\phi_{g'}\left(\bm{x}\right)+\frac{\chi_{g}\left(\bm{x}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}\right)\phi_{g'}\left(\bm{x}\right)+Q_{0,g}\left(\bm{x}\right),\\
\bm{x}\in V,\quad g=1,\dots,G.\label{eq:multigroup-diffusion-steady}
\end{multline}

\end_inset


\end_layout

\begin_layout Subsection
From spatially discretized transport equations
\end_layout

\begin_layout Standard
Another possible method to derive the diffusion equations is to start at
 the spatially and angularly-discretized transport equation and calculate
 a discrete approximation to the transport discretization.
 Although untested, this could possibly allow use of DSA in problems that
 would otherwise lack consistency between the transport and diffusion discretiza
tions.
 
\end_layout

\begin_layout Itemize
Define 
\begin_inset Formula $\phi$
\end_inset

 and 
\begin_inset Formula $\bm{J}$
\end_inset

 in a discrete way as the sums of weights
\end_layout

\begin_layout Itemize
Define coefficents 
\begin_inset Formula $\beta$
\end_inset

 and 
\begin_inset Formula $\gamma$
\end_inset

 as the expansion coefficients for 
\begin_inset Formula $\phi$
\end_inset

 and 
\begin_inset Formula $\bm{J}$
\end_inset


\end_layout

\begin_layout Itemize
Perform 
\begin_inset Formula $\sum_{n}w_{n}\left(\cdot\right)$
\end_inset

 and 
\begin_inset Formula $\sum_{n}w_{n}\bm{\Omega}_{n}\left(\cdot\right)$
\end_inset

 over discretized equation (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:strong-discretized-transport"

\end_inset

 or 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:petrov-galerkin"

\end_inset

)
\end_layout

\begin_layout Itemize
Define matrices for each part of the equation
\end_layout

\begin_layout Itemize
Solve the second equation for 
\begin_inset Formula $\bm{J}_{g}$
\end_inset


\end_layout

\begin_layout Itemize
Insert this solution (which will involve a matrix inverse) into the first
 equation
\end_layout

\begin_layout Section
Spatial discretization of the diffusion equations
\end_layout

\begin_layout Subsection
Strong discretization
\end_layout

\begin_layout Standard
The derivation of the strong form of the diffusion equations is identical
 to the derivation for the angular flux.
 Use the expansion in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:moments-expansion"

\end_inset

 in the diffusion equation and evaluate at discrete centers 
\begin_inset Formula $\bm{x}_{i}$
\end_inset

 to get 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{multline}
\sum_{i=1}^{J}\left[-D_{g}\left(\bm{x}_{j}\right)\nabla^{2}b_{i}\left(\bm{x}_{j}\right)+\Sigma_{t;g}\left(\bm{x}\right)b_{i}\left(\bm{x}_{j}\right)\right]\beta_{i,g}\\
=\sum_{g'=1}^{G}\Sigma_{s;0,g'\to g}\left(\bm{x}_{j}\right)\phi_{g'}\left(\bm{x}_{j}\right)+\frac{\chi_{g}\left(\bm{x}_{j}\right)}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;g'}\left(\bm{x}_{j}\right)\phi_{g'}\left(\bm{x}_{j}\right)+Q_{0,g}\left(\bm{x}_{j}\right),\\
j=1,\dots,J,\quad g=1,\dots,G.\label{eq:multigroup-diffusion-strong}
\end{multline}

\end_inset

The 
\begin_inset Formula $\phi$
\end_inset

 values on the RHS can also be expressed in terms of 
\begin_inset Formula $\beta_{i,g}$
\end_inset

 if desired, or the system can be written in terms of 
\begin_inset Formula $\phi_{i,g}$
\end_inset

 with some localization procedure.
 The boundary conditions are 
\begin_inset Formula 
\begin{equation}
\frac{1}{4}\sum_{i=1}^{J}\left[b_{i}\left(\bm{x}\right)+2D_{g}\left(\bm{x}\right)\bm{n}\cdot\bm{\nabla}b_{i}\left(\bm{x}\right)\right]\beta_{i,g}=J_{g}^{b-}\left(\bm{x},t\right),\qquad j=1,\dots,J,\quad g=1,\dots,G.
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Weak discretization
\end_layout

\begin_layout Standard
To derive the weak form of the diffusion equations, we take a few steps
 back to Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:p1-phi"

\end_inset

 to correctly account for the incoming and outgoing partial currents.
 Neglect the time derivative, assume the cross sections are constant or
 weighted in each integration region and apply 
\begin_inset Formula $\int_{V_{j}}w_{j}\left(\cdot\right)dV$
\end_inset

 to get 
\begin_inset Formula 
\begin{multline}
\int_{V_{j}}w_{j}\left(\bm{x}\right)\bm{\nabla}\cdot\bm{J}_{g}\left(\bm{x}\right)dV+\Sigma_{t;j,g}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{g}\left(\bm{x}\right)dV\\
=\sum_{g'=1}^{G}\Sigma_{s;j,0,g'\to g}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{g'}\left(\bm{x}\right)dV+\frac{\chi_{j,g}}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;j,g'}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{g'}\left(\bm{x}\right)dV\\
+\int_{V_{j}}w_{j}\left(\bm{x}\right)Q_{0,g}\left(\bm{x}\right)dV,\\
\bm{x}\in V,\quad g=1,\dots,G,\quad0<t.\label{eq:p1-phi-integrated}
\end{multline}

\end_inset

Use the definitions of 
\begin_inset Formula $J^{+}$
\end_inset

 and 
\begin_inset Formula $J^{-}$
\end_inset

 to derive a relationship with 
\begin_inset Formula $\bm{J}$
\end_inset

,
\begin_inset Formula 
\begin{align*}
\bm{n}\cdot\bm{J}_{g}\left(\bm{x}\right) & =\bm{n}\cdot\int_{4\pi}\bm{\Omega}\psi_{g}\left(\bm{x},\bm{\Omega}\right)d\Omega\\
 & =\int_{\bm{\Omega}\cdot\bm{n}>0}\bm{\Omega}\cdot\bm{n}\psi_{g}\left(\bm{x},\bm{\Omega}\right)d\Omega-\int_{\bm{\Omega}\cdot\bm{n}<0}\bm{\Omega}\cdot\bm{n}\psi_{g}\left(\bm{x},\bm{\Omega}\right)d\Omega\\
 & =J_{g}^{+}\left(\bm{x}\right)-J_{g}^{-}\left(\bm{x}\right).
\end{align*}

\end_inset

The streaming term then becomes
\begin_inset Formula 
\begin{align}
\int_{V_{j}}w_{j}\left(\bm{x}\right)\bm{\nabla}\cdot\bm{J}_{g}\left(\bm{x}\right)dV & =\int_{S_{j}}w_{j}\left(\bm{x}\right)\left(\bm{n}\cdot\bm{J}\left(\bm{x}\right)\right)dS-\int_{V_{j}}\left[\bm{\nabla}w_{j}\left(\bm{x}\right)\right]\cdot\bm{J}\left(\bm{x}\right)dV\\
 & =\int_{S_{j}}w_{j}\left(\bm{x}\right)\left[J_{g}^{+}\left(\bm{x}\right)-J_{g}^{-}\left(\bm{x}\right)\right]dS-\int_{V_{j}}\left[\bm{\nabla}w_{j}\left(\bm{x}\right)\right]\cdot\bm{J}\left(\bm{x}\right)dV.
\end{align}

\end_inset

To review, 
\begin_inset Formula $J_{g}^{+}$
\end_inset

 represents the outgoing flux at the boundary (which we do not know a priori)
 and 
\begin_inset Formula $J_{g}^{-}$
\end_inset

 represents the incoming flux at the boundary (which is known for the boundary
 source but not for reflection).
 Using Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:diffusion-current-boundary"

\end_inset

, this the streaming term can be expanded to include the boundary condition,
\begin_inset Formula 
\[
\int_{S_{j}}w_{j}\left(\bm{x}\right)\left[J_{g}^{+}\left(\bm{x}\right)-J_{g}^{-}\left(\bm{x}\right)\right]dS=\int_{S_{j}}w_{j}\left(\bm{x}\right)\left[\left(1-\rho\right)J_{g}^{+}\left(\bm{x}\right)-J_{g}^{b-}\left(\bm{x}\right)\right]dS.
\]

\end_inset

Putting the transport equation back together, we get
\begin_inset Formula 
\begin{multline}
\left(1-\rho\right)\int_{S_{j}}w_{j}\left(\bm{x}\right)J_{g}^{+}\left(\bm{x}\right)dS-\int_{V_{j}}\left[\bm{\nabla}w_{j}\left(\bm{x}\right)\right]\cdot\bm{J}\left(\bm{x}\right)dV+\Sigma_{t;j,g}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{g}\left(\bm{x}\right)dV\\
=\sum_{g'=1}^{G}\Sigma_{s;j,0,g'\to g}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{g'}\left(\bm{x}\right)dV+\frac{\chi_{j,g}}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;j,g'}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{g'}\left(\bm{x}\right)dV\\
+\int_{V_{j}}w_{j}\left(\bm{x}\right)Q_{0,g}\left(\bm{x}\right)dV+\int_{S_{j}}w_{j}\left(\bm{x}\right)J_{g}^{b-}\left(\bm{x}\right)dS,\\
\bm{x}\in V,\quad g=1,\dots,G.\label{eq:p1-weak}
\end{multline}

\end_inset

Using Fick's Law (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ficks-law"

\end_inset

) and the partial currents (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:partial-currents-flux"

\end_inset

), the final equations are
\begin_inset Formula 
\begin{multline}
\left(\frac{1-\rho}{4}\right)\left[\int_{S_{j}}w_{j}\left(\bm{x}\right)\phi_{g}\left(\bm{x},t\right)dS-2D_{j,g}\bm{n}\cdot\int_{S_{j}}w_{j}\left(\bm{x}\right)\bm{\nabla}\phi_{g}\left(\bm{x}\right)dS\right]+D_{j,g}\int_{V_{j}}\left[\bm{\nabla}w_{j}\left(\bm{x}\right)\right]\cdot\left[\bm{\nabla}\phi_{g}\left(\bm{x}\right)\right]dV\\
+\Sigma_{t;j,g}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{g}\left(\bm{x}\right)dV\\
=\sum_{g'=1}^{G}\Sigma_{s;j,0,g'\to g}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{g'}\left(\bm{x}\right)dV+\frac{\chi_{j,g}}{4\pi}\sum_{g'=1}^{G}\nu\Sigma_{f;j,g'}\int_{V_{j}}w_{j}\left(\bm{x}\right)\phi_{g'}\left(\bm{x}\right)dV\\
+\int_{V_{j}}w_{j}\left(\bm{x}\right)Q_{0,g}\left(\bm{x}\right)dV+\int_{S_{j}}w_{j}\left(\bm{x}\right)J_{g}^{b-}\left(\bm{x}\right)dS,\\
\bm{x}\in V,\quad g=1,\dots,G.\label{eq:weak-diffusion}
\end{multline}

\end_inset


\end_layout

\begin_layout Part
Iteration methods
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
Introduce operator notation
\end_layout

\end_inset


\end_layout

\begin_layout Section
Operator notation
\end_layout

\begin_layout Standard
The steady-state neutron transport equation can be written in operator notation
 for both the strong and weak forms of the equation.
 In either case we have the transport operator 
\begin_inset Formula $\mathcal{L}$
\end_inset

, the discrete-to-moment operator 
\begin_inset Formula $\mathcal{D}$
\end_inset

, the moment-to-discrete operator 
\begin_inset Formula $\mathcal{M}$
\end_inset

, the scattering operator 
\begin_inset Formula $\mathcal{S}$
\end_inset

 and the fission operator 
\begin_inset Formula $\mathcal{F}$
\end_inset

.
 The transport equation can then be written as
\begin_inset Formula 
\begin{equation}
\mathcal{L}\psi=\mathcal{M}\left(\mathcal{S}+\mathcal{F}\right)\mathcal{D}\psi+s.\label{eq:operator}
\end{equation}

\end_inset

For the strong form of the equation, we have (from Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:steady-state-transport"

\end_inset

) 
\begin_inset Formula 
\begin{gather}
\left(\mathcal{L}\psi\right)_{n,g,j}=\bm{\Omega}\cdot\bm{\nabla}\psi_{n,g}+\Sigma_{t,g}\psi_{n,g}\bigg|_{\bm{x}=\bm{x}_{j}},\\
\left(\mathcal{D}\psi\right)_{\ell,g,j}^{m}=\sum_{n}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)w_{n}\psi_{n,g}\bigg|_{\bm{x}=\bm{x}_{j}},\\
\left(\mathcal{M}\phi\right)_{n,g,j}=\sum_{\ell}\frac{2\ell+1}{4\pi}\sum_{m}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\phi_{\ell,g}^{m}\bigg|_{\bm{x}=\bm{x}_{j}},\\
\left(\mathcal{S}\phi\right)_{\ell,g,j}^{m}=\sum_{g'}\Sigma_{s,\ell,g'\to g}^{m}\phi_{\ell,g'}^{m}\bigg|_{\bm{x}=\bm{x}_{j}},\\
\left(\mathcal{F}\phi\right)_{\ell,g,j}^{m}=\delta_{\ell,0}\chi_{g}\sum_{g'}\nu_{g'}\Sigma_{f,g'}\phi_{\ell,g'}^{m}\bigg|_{\bm{x}=\bm{x}_{j}},\\
s=q\bigg|_{\bm{x}=\bm{x}_{j}}
\end{gather}

\end_inset

The weak form of the equation with constant or weighted coefficients (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:constant-xs-transport"

\end_inset

) becomes
\begin_inset Formula 
\begin{gather}
\left(\mathcal{L}\psi\right)_{n,g,j}=\int_{\bm{\Omega}_{n}\cdot\bm{n}>0}\left(\bm{\Omega}_{n}\cdot\bm{n}\right)\psi_{n,g}w_{j}dS-\int_{V_{j}}\psi_{n,g}\left[\bm{\Omega}\cdot\bm{\nabla}w_{j}\right]dV+\Sigma_{t;g,j}\int_{V_{j}}w_{j}\psi_{n,g}dV,\\
\left(\mathcal{D}\psi\right)_{\ell,g,j}^{m}=\sum_{n}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)w_{n}\psi_{n,g}\\
\left(\mathcal{M}\phi\right)_{n,g,j}=\sum_{\ell=0}^{L}\frac{2\ell+1}{4\pi}\sum_{m=-\ell}^{\ell}Y_{\ell}^{m}\left(\bm{\Omega}_{n}\right)\phi_{\ell,g}^{m},\\
\left(\mathcal{S}\phi\right)_{\ell,g,j}^{m}=\sum_{g'=1}^{G}\Sigma_{s;\ell,g'\to g,j}\int_{V_{j}}w_{j}\phi_{\ell,g'}^{m}dV,\\
\left(\mathcal{F}\phi\right)_{\ell,g,j}^{m}=\delta_{\ell,0}\chi_{g,j}\sum_{g'=1}^{G}\nu\Sigma_{f,g',j}\int_{V_{j}}w_{j}\phi_{0,g'}^{0}\left(\bm{x}\right)dV,\\
s_{n,g,j}=\int_{V_{j}}w_{j}q_{n,g}dV+\sum_{i=1}^{J}\alpha_{i,n,g}^{b}\int_{\bm{\Omega}_{n}\cdot\bm{n}<0}\left|\bm{\Omega}_{n}\cdot\bm{n}\right|b_{i}w_{j}dS.
\end{gather}

\end_inset

When we add basis functions, the weak form can also be written as iteration
 over the coefficients of the solution, which can be solved for instead
 of the angular flux or its moments.
 From Eqs.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:petrov-galerkin"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:coefficient-relation"

\end_inset

, we have
\begin_inset Formula 
\begin{gather}
\left(\tilde{\mathcal{L}}\alpha\right)_{n,g,j}=\sum_{i=1}^{J}\left[\int_{\bm{\Omega}_{n}\cdot\bm{n}>0}\left(\bm{\Omega}_{n}\cdot\bm{n}\right)b_{i}w_{j}dS-\int_{V_{j}}b_{i}\left(\bm{x}\right)\left[\bm{\Omega}_{n}\cdot\bm{\nabla}w_{j}\right]dV+\Sigma_{t;g,j}\int_{V_{j}}b_{i}w_{j}dV\right]\alpha_{i,n,g},\\
\left(\tilde{\mathcal{S}}\beta\right)_{\ell,g,j}^{m}=\sum_{g'}\Sigma_{s;\ell,g'\to g,j}^{m}\sum_{i=1}^{J}\beta_{\ell,g',j}^{m}\int_{V_{j}}b_{i}w_{j}dV,\\
\left(\tilde{\mathcal{F}}\beta\right)_{\ell,g,j}^{m}=\delta_{\ell,0}\chi_{g,j}\sum_{g'}\nu\Sigma_{f;g',j}\sum_{i=1}^{J}\beta_{i,0,g'}^{0}\int_{V_{j}}b_{i}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV,\\
s_{n,g,j}=\int_{V_{j}}w_{j}q_{n,g}dV+\sum_{i=1}^{J}\alpha_{i,n,g}^{b}\int_{\bm{\Omega}_{n}\cdot\bm{n}<0}\left|\bm{\Omega}_{n}\cdot\bm{n}\right|b_{i}w_{j}dS,
\end{gather}

\end_inset

while the definitions of 
\begin_inset Formula $\mathcal{M}$
\end_inset

 and 
\begin_inset Formula $\mathcal{D}$
\end_inset

 remain unchanged.
 If we define 
\begin_inset Formula 
\begin{equation}
\tilde{\phi}_{\ell,g,j}^{m}=\sum_{i=1}^{J}\beta_{\ell,g',j}^{m}\int_{V_{j}}b_{i}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV,
\end{equation}

\end_inset

the scattering and fission operators become
\begin_inset Formula 
\begin{gather}
\left(\mathcal{S}\beta\right)_{\ell,g,j}^{m}=\sum_{g'}\Sigma_{s;\ell,g'\to g,j}^{m}\tilde{\phi}_{\ell,g',j}^{m},\\
\left(\mathcal{F}\beta\right)_{\ell,g,j}^{m}=\delta_{\ell,0}\chi_{g,j}\sum_{g'}\nu\Sigma_{f;g',j}\tilde{\phi}_{\ell,g',j},
\end{gather}

\end_inset

which is in the same form as the strong form of the problem.
 Thus, if we define 
\begin_inset Formula 
\begin{equation}
\left(\tilde{\mathcal{C}}\beta\right)_{\ell,g,j}^{m}=\sum_{i=1}^{J}\beta_{i,\ell,g'}^{m}\int_{V_{j}}b_{i}\left(\bm{x}\right)w_{j}\left(\bm{x}\right)dV,
\end{equation}

\end_inset

then we can write the system of equations as
\begin_inset Formula 
\begin{equation}
\tilde{\mathcal{L}}\alpha=\mathcal{M}\left(\mathcal{S}+\mathcal{F}\right)\tilde{\mathcal{C}}\mathcal{D}\alpha+s,
\end{equation}

\end_inset

after which the operators 
\begin_inset Formula $\mathcal{M}$
\end_inset

, 
\begin_inset Formula $\mathcal{S}$
\end_inset

 and 
\begin_inset Formula $\mathcal{F}$
\end_inset

 and 
\begin_inset Formula $\mathcal{D}$
\end_inset

 are unchanged.
 Most of the time in finite element methods, the basis functions have the
 Dirac delta property, which means that the value of the function at the
 nodes is equal to the value of the corresponding coefficient,
\begin_inset Formula 
\begin{equation}
\psi\left(\bm{x}_{i}\right)=\alpha_{i}.
\end{equation}

\end_inset

In these cases, the 
\begin_inset Formula $\tilde{\mathcal{C}}$
\end_inset

 operator would not be needed, as the nodal values of the angular flux directly
 produce the nodal values for its moments, the scattering source and fission,
 which are then automatically interpolated in the basis expansion.
 The addition of the 
\begin_inset Formula $\tilde{\mathcal{C}}$
\end_inset

 operator 
\end_layout

\begin_layout Itemize
Allows for solution using basis functions without the Dirac delta property,
 
\end_layout

\begin_layout Itemize
Moves the integrals outside of the scattering and fission operator definitions,
 and 
\end_layout

\begin_layout Itemize
Prevents spatial information from being destroyed that would then need to
 be reintroduced by interpolation.
 
\end_layout

\begin_layout Section
Steady-state equation
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
Make sure to include information on the boundary terms
\end_layout

\end_inset


\end_layout

\begin_layout Standard
To solve for the moments of the angular flux instead of the angular flux
 itself, apply the operator 
\begin_inset Formula $\mathcal{D}\mathcal{L}^{-1}$
\end_inset

 to each side of Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:operator"

\end_inset

 to get 
\begin_inset Formula 
\[
\phi=\mathcal{D}\mathcal{L}^{-1}M\left(\mathcal{S}+\mathcal{F}\right)\phi+DL^{-1}s.
\]

\end_inset

This equation can be used for source (or Richardson) iteration.
 Gathering the 
\begin_inset Formula $\phi$
\end_inset

 terms gives
\begin_inset Formula 
\[
\left(\mathcal{I}-\mathcal{D}\mathcal{L}^{-1}\mathcal{M}\left(\mathcal{S}+\mathcal{F}\right)\right)\phi=\mathcal{D}\mathcal{L}^{-1}s,
\]

\end_inset

which is a form suitable for solution by Krylov iteration.
 These equations include the source term, 
\begin_inset Formula $\mathcal{D}\mathcal{L}^{-1}s$
\end_inset

, which includes the contribution of the boundary term and represents the
 first-flight flux.
 To handle reflective boundaries, we follow Warsa et.
 al 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
cite{warsa-krylov-2004}
\end_layout

\end_inset

 and use augments to store the outgoing flux at the boundaries for the next
 iteration.
 For the source term, this means iterating on the source and its reflected
 component until convergence is reached.
 Once convergence is reached, the augments in the source term are zeroed
 out (since the first-flight flux already includes the boundary source).
 The terms 
\begin_inset Formula $\mathcal{D}$
\end_inset

, 
\begin_inset Formula $\mathcal{M}$
\end_inset

, 
\begin_inset Formula $\mathcal{S}$
\end_inset

 and 
\begin_inset Formula $\mathcal{F}$
\end_inset

 ignore the augments, which are only used inside 
\begin_inset Formula $\mathcal{L}^{-1}$
\end_inset

.
 The identity operator is still an identity operator for the augments.
 Mathematically, the augments do the following:
\begin_inset Formula 
\begin{gather*}
\phi\to\left[\begin{array}{c}
\phi\\
\psi_{R}
\end{array}\right],\\
\mathcal{D}\to\left[\begin{array}{cc}
\mathcal{D} & 0\\
0 & \mathcal{I}_{R}
\end{array}\right],\\
\mathcal{M}\to\left[\begin{array}{cc}
\mathcal{M} & 0\\
0 & \mathcal{I}_{R}
\end{array}\right],\\
\mathcal{S}\to\left[\begin{array}{cc}
\mathcal{S} & 0\\
0 & \mathcal{I}_{R}
\end{array}\right],\\
s\to\left[\begin{array}{c}
s\\
0
\end{array}\right].
\end{gather*}

\end_inset

Optionally, another two operators can be added that represent adding the
 augments into the angular flux and storing the reflected flux after the
 action of 
\begin_inset Formula $\mathcal{L}^{-1}$
\end_inset

.
 In this code, these two operators are included in the 
\begin_inset Formula $\mathcal{L}^{-1}$
\end_inset

 operator.
 
\end_layout

\begin_layout Section
k-eigenvalue equation
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
Include introduction earlier to k-eigenvalue equation
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The k-eigenvalue equation can be written in operator notation as
\begin_inset Formula 
\begin{equation}
\mathcal{L}\psi=\mathcal{M}\left(\mathcal{S}+\frac{1}{k}\mathcal{F}\right)\mathcal{D}\psi,
\end{equation}

\end_inset

where the operators are defined the same as in the steady-state case and
 the eigenvalue is 
\begin_inset Formula $k$
\end_inset

.
 This can be written in moment form as
\begin_inset Formula 
\begin{equation}
\phi=D\mathcal{L}^{-1}\mathcal{M}\left(\mathcal{S}+\frac{1}{k}\mathcal{F}\right)\phi,
\end{equation}

\end_inset

which represents fixed point iteration.
 After each iteration, the eigenvalue is updated as
\begin_inset Formula 
\[
k^{\left(\ell+1\right)}=\frac{\left\Vert \mathcal{F}\phi^{\left(\ell+1\right)}\right\Vert }{\left\Vert \frac{1}{k^{\left(\ell\right)}}\mathcal{F}\phi^{\left(\ell\right)}-\mathcal{S}\left(\phi^{\ell+1}-\phi^{\ell}\right)\right\Vert }.
\]

\end_inset

To derive the equations for power iteration, isolate the fission term and
 the invert the equation onto it, which gives
\begin_inset Formula 
\[
\phi=\left(\mathcal{I}-\mathcal{D}\mathcal{L}^{-1}\mathcal{M}\mathcal{S}\right)^{-1}\mathcal{D}\mathcal{L}^{-1}\mathcal{M}\frac{1}{k}\mathcal{F}\phi.
\]

\end_inset

For power iteration, the eigenvalue is updated after each iteration as
\begin_inset Formula 
\[
k^{\left(\ell+1\right)}=\frac{\left\Vert \mathcal{F}\phi^{\left(\ell+1\right)}\right\Vert }{\left\Vert \frac{1}{k^{\left(\ell\right)}}\mathcal{F}\phi^{\left(\ell\right)}\right\Vert }.
\]

\end_inset

Finally, for Krylov eigenvalue iteration, isolate the eigenvalue in the
 equation to get
\begin_inset Formula 
\[
\left(\mathcal{I}-\mathcal{D}\mathcal{L}^{-1}\mathcal{M}\mathcal{S}\right)^{-1}D\mathcal{L}^{-1}\mathcal{M}\mathcal{F}\phi=k\phi.
\]

\end_inset

For power and Krylov eigenvalue iteration, the inverse of the operator 
\begin_inset Formula $\left(\mathcal{I}-\mathcal{D}\mathcal{L}^{-1}\mathcal{M}\mathcal{S}\right)^{-1}$
\end_inset

 is needed, which is roughly the action needed when inverting the steady-state
 operator.
 This inverse can be performed by a standard Krylov solver such as GMRES.
 The full system can be solved with a Krylov eigensolver that admits asymmetric
 matrices, such as Block Krylov-Schur or Generalized Davidson.
 
\end_layout

\begin_layout Standard
\begin_inset Note Greyedout
status open

\begin_layout Section
Time-dependent equation (not yet implemented)
\end_layout

\begin_layout Plain Layout
\begin_inset Note Comment
status open

\begin_layout Plain Layout
Crank-Nicolson for now
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
Define 
\begin_inset Formula 
\[
\mathcal{T}\psi_{j,n,g}=\frac{\psi_{j,n,g}}{2\Delta t}.
\]

\end_inset

Then Crank-Nicolson can be written as 
\begin_inset Formula 
\[
\mathcal{T}\psi^{\left(\ell+1\right)}-\mathcal{T}\psi^{\left(\ell\right)}=\left[\mathcal{M}\left(\mathcal{S}+\mathcal{F}\right)\mathcal{D}-\mathcal{L}\right]\psi^{\left(\ell+1\right)}+\left[\mathcal{M}\left(\mathcal{S}+\mathcal{F}\right)\mathcal{D}-\mathcal{L}\right]\psi^{\left(\ell\right)}+s^{\left(\ell+1\right)}+s^{\left(\ell\right)}
\]

\end_inset

Define the 
\begin_inset Formula $\mathcal{L}_{+}$
\end_inset

 and 
\begin_inset Formula $\mathcal{L}_{-}$
\end_inset

 operators as 
\begin_inset Formula 
\begin{gather*}
\mathcal{L}_{+}=\mathcal{L}+\mathcal{T},\\
\mathcal{L}_{-}=\mathcal{L}-\mathcal{T},
\end{gather*}

\end_inset

to get
\begin_inset Formula 
\[
\mathcal{L}_{+}\psi^{\left(\ell+1\right)}=\mathcal{M}\left(\mathcal{S}+\mathcal{F}\right)\mathcal{D}\psi^{\left(\ell+1\right)}+\left[\mathcal{M}\left(\mathcal{S}+\mathcal{F}\right)\mathcal{D}-\mathcal{L}_{-}\right]\psi^{\left(\ell\right)}+s^{\left(\ell+1\right)}+s^{\left(\ell\right)}.
\]

\end_inset

The problem can then be written in the same form as a fixed-source problem,
\begin_inset Formula 
\[
\phi^{\left(\ell+1\right)}=\mathcal{D}\mathcal{L}_{+}^{-1}\mathcal{M}\left(\mathcal{S}+\mathcal{F}\right)\phi^{\left(\ell+1\right)}+\mathcal{D}\mathcal{L}_{+}^{-1}\tilde{s}^{\left(\ell+1\right)},
\]

\end_inset

with
\begin_inset Formula 
\[
\tilde{s}^{\left(\ell+1\right)}=\left[\mathcal{M}\left(\mathcal{S}+\mathcal{F}\right)\mathcal{D}-\mathcal{L}_{-}\right]\psi^{\left(\ell\right)}+s^{\left(\ell+1\right)}+s^{\left(\ell\right)}.
\]

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Part
Meshless methods
\end_layout

\begin_layout Section
Radial basis functions
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
Regular and compact.
 Show how interpolation might be done.
 Include pictures.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Introduction to radial basis functions
\end_layout

\begin_layout Standard
The value of a radial basis function (RBF) depends only on the distance
 traversed by the input vector, 
\begin_inset Formula 
\[
\Gamma\left(\bm{x}\right)=\Gamma\left(\left\Vert \bm{x}\right\Vert \right)=\Gamma\left(r\right),
\]

\end_inset

regardless of the number of dimensions.
 Examples of radial basis functions include the Gaussian (GA), multiquadric
 (MQ) and inverse multiquadric (IMQ), 
\begin_inset Formula 
\begin{align}
\text{GA} & :\qquad\Gamma\left(r\right)=e^{-\left(r\right)^{2}},\\
\text{MQ} & :\qquad\Gamma\left(r\right)=\sqrt{1+\left(r\right)^{2}},\\
\text{IMQ} & :\qquad\Gamma\left(r\right)=\frac{1}{\sqrt{1+\left(r\right)^{2}}}.
\end{align}

\end_inset

 RBFs can act as a functional basis,
\begin_inset Formula 
\begin{equation}
f\left(\bm{x}\right)=\sum_{i}a_{i}\Gamma_{i}\left(\bm{x}\right),\label{eq:rbf-basis}
\end{equation}

\end_inset

where 
\begin_inset Formula 
\begin{equation}
\Gamma_{i}\left(\bm{x}\right)=\Gamma\left(\epsilon_{i}\left\Vert \bm{x}-\bm{x}_{i}\right\Vert \right),
\end{equation}

\end_inset

where 
\begin_inset Formula $\epsilon_{i}$
\end_inset

 is the shape parameter, which controls how quickly the RBF increases or
 decreases away from the center, and 
\begin_inset Formula $\bm{x}_{i}$
\end_inset

 is the location of the center of the basis function.
 
\end_layout

\begin_layout Standard
For interpolation, a pointwise or an integral method can be used.
 For pointwise interpolation, given certain sample points located at 
\begin_inset Formula $\bm{x}_{i}$
\end_inset

, equations are
\begin_inset Formula 
\begin{equation}
\left[\begin{array}{cccc}
\Gamma_{1}\left(\bm{x}_{1}\right) & \Gamma_{2}\left(\bm{x}_{1}\right) & \cdots & \Gamma_{I}\left(\bm{x}_{1}\right)\\
\Gamma_{1}\left(\bm{x}_{2}\right) & \Gamma_{2}\left(\bm{x}_{2}\right) & \cdots & \Gamma_{I}\left(\bm{x}_{2}\right)\\
\vdots & \vdots & \vdots & \vdots\\
\Gamma_{1}\left(\bm{x}_{I}\right) & \Gamma_{2}\left(\bm{x}_{I}\right) & \cdots & \Gamma_{I}\left(\bm{x}_{I}\right)
\end{array}\right]\left[\begin{array}{c}
a_{1}\\
a_{2}\\
\vdots\\
a_{I}
\end{array}\right]=\left[\begin{array}{c}
f\left(\bm{x}_{1}\right)\\
f\left(\bm{x}_{2}\right)\\
\vdots\\
f\left(\bm{x}_{I}\right)
\end{array}\right].
\end{equation}

\end_inset

The interpolant can then be evaluated using Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:rbf-basis"

\end_inset

 using the calculated 
\begin_inset Formula $a_{i}$
\end_inset

 values.
 For weak interpolation using the Galerkin method, these functions are instead
\begin_inset Formula 
\begin{equation}
\left[\begin{array}{cccc}
\int_{V}\tilde{\Gamma}_{1}\left(\bm{x}\right)\Gamma_{1}\left(\bm{x}\right)dV & \int_{V}\tilde{\Gamma}_{1}\left(\bm{x}\right)\Gamma_{2}\left(\bm{x}\right)dV & \cdots & \int_{V}\tilde{\Gamma}_{1}\left(\bm{x}\right)\Gamma_{I}\left(\bm{x}\right)dV\\
\int_{V}\tilde{\Gamma}_{2}\left(\bm{x}\right)\Gamma_{1}\left(\bm{x}\right)dV & \int_{V}\tilde{\Gamma}_{2}\left(\bm{x}\right)\Gamma_{2}\left(\bm{x}\right)dV & \cdots & \int_{V}\tilde{\Gamma}_{2}\left(\bm{x}\right)\Gamma_{I}\left(\bm{x}\right)dV\\
\vdots & \vdots & \vdots & \vdots\\
\int_{V}\tilde{\Gamma}_{I}\left(\bm{x}\right)\Gamma_{1}\left(\bm{x}\right)dV & \int_{V}\tilde{\Gamma}_{I}\left(\bm{x}\right)\Gamma_{2}\left(\bm{x}\right)dV & \cdots & \int_{V}\tilde{\Gamma}_{I}\left(\bm{x}\right)\Gamma_{I}\left(\bm{x}\right)dV
\end{array}\right]\left[\begin{array}{c}
a_{1}\\
a_{2}\\
\vdots\\
a_{I}
\end{array}\right]=\left[\begin{array}{c}
\int_{V}\tilde{\Gamma}_{1}\left(\bm{x}\right)f\left(\bm{x}\right)dV\\
\int_{V}\tilde{\Gamma}_{2}\left(\bm{x}\right)f\left(\bm{x}\right)dV\\
\vdots\\
\int_{V}\tilde{\Gamma}_{I}\left(\bm{x}\right)f\left(\bm{x}\right)dV
\end{array}\right],
\end{equation}

\end_inset

where the 
\begin_inset Formula $\tilde{\Gamma}$
\end_inset

 are the weight functions (which would be the same as the basis functions
 in the Galerkin method).
 In practice, the weak form would not be used for interpolation since the
 function 
\begin_inset Formula $f\left(\bm{x}\right)$
\end_inset

 would need to be known at all points in the domain a priori, which would
 defeat the purpose of interpolation.
 This second method is mentioned to show how the Galerkin method could work
 when solving a differential equation.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:gaussian-interpolation"

\end_inset

 shows the interpolation results.
 The basis (and weight, where applicable) functions are a set of Gaussian
 basis functions over a slab of length 
\begin_inset Formula $L=1$
\end_inset

 with a constant spacing of 
\begin_inset Formula $\Delta x=L/I$
\end_inset

 and shape parameters of 
\begin_inset Formula $\epsilon_{i}=1/\Delta x$
\end_inset

.
 The unscaled basis functions are all identical.
 Once the interpolation is completed, the scaled basis functions show how
 each of the basis functions contributes individually to the interpolant.
 The weak interpolant does not perform significantly better than the strong
 interpolant in this case.
 The weak interpolant near the boundary is poor due to the integral nature
 of the interpolantion.
 The interpolant struggles where the function is not smooth (near the discontinu
ities in the first derivative).
 
\end_layout

\begin_layout Standard
The Gaussian functions fail to exactly reproduce a constant and a linear
 function correctly, which means they do not satisfy the Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:sum-weight"

\end_inset

.
 This means that they are not ideal for use as weight functions in a Petrov-Gale
rkin method as they will not exactly enforce conservation.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:gaussian-const"

\end_inset

 shows the attempted fit to a constant and to a linear function.
 The error is nonzero except at the interpolation points.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figs/saw_gauss_17_1.0_basis.pdf
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Basis function set, 
\begin_inset Formula $\Gamma_{i}\left(\bm{x}\right)$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figs/saw_gauss_17_1.0_const.pdf
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Interpolation of a constant and a linear function
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Gaussian basis with 17 points
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:gaussian-const"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figs/saw_gauss_17_1.0_partial.pdf
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Scaled basis functions for the pointwise interpolation, 
\begin_inset Formula $a_{i}\Gamma_{i}\left(\bm{x}\right)$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figs/saw_gauss_17_1.0_interp.pdf
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Interpolation result
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Interpolation of a sawtooth wave using 17 identical Gaussian basis and weight
 functions
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:gaussian-interpolation"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Localization of basis functions
\end_layout

\begin_layout Section
Moving least squares
\end_layout

\begin_layout Standard
The moving least squares method is one meshless approach to basis functions
 that retains the ability to represent a certain order of polynomials exactly.
 The idea is to minimize error of the function 
\begin_inset Formula $f\left(\bm{x}\right)$
\end_inset

 with respect to some values 
\begin_inset Formula $f_{i}$
\end_inset

 in a least-squares sense.
 
\end_layout

\begin_layout Standard
\begin_inset Note Greyedout
status open

\begin_layout Plain Layout
EXPLAIN MINIMIZATION, DERIVE METHOD
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Start with a basis of 
\begin_inset Formula $m$
\end_inset

 polynomials and 
\begin_inset Formula $n$
\end_inset

 points.
 The shape functions themselves are simply 
\begin_inset Formula 
\begin{align*}
\phi_{i}\left(\bm{x}\right) & =\bm{p}^{\top}\left(\bm{x}\right)\bm{A}^{-1}\left(\bm{x}\right)\bm{B}_{i}\left(\bm{x}\right),
\end{align*}

\end_inset

with
\begin_inset Formula 
\begin{gather*}
\bm{p}^{\top}\left(\bm{x}\right)=\left\{ p_{0}\left(\bm{x}\right),p_{1}\left(\bm{x}\right),p_{2}\left(\bm{x}\right),\dots,p_{m}\left(\bm{x}\right)\right\} =\left\{ 1,x,y,z,xy,xz,yz,x^{2},y^{2},z^{2},\dots\right\} ,\\
\bm{A}\left(\bm{x}\right)=\sum_{i=1}^{n}W_{i}\left(\bm{x}\right)\bm{p}\left(\bm{x}_{i}\right)\bm{p}^{\top}\left(\bm{x}_{i}\right),\\
\bm{B}_{i}\left(\bm{x}\right)=w_{i}\left(\bm{x}\right)\bm{p}\left(\bm{x}_{i}\right),
\end{gather*}

\end_inset

where 
\begin_inset Formula $w_{i}\left(\bm{x}\right)$
\end_inset

 is a weighting function centered at the point 
\begin_inset Formula $\bm{x}_{i}$
\end_inset

.
 The derivatives are
\begin_inset Formula 
\[
\frac{\partial\phi_{i}\left(\bm{x}\right)}{\partial x_{j}}=\frac{\partial\bm{p}^{\top}\left(\bm{x}\right)}{\partial x_{j}}\bm{A}^{-1}\left(\bm{x}\right)\bm{B}_{i}\left(\bm{x}\right)+\bm{p}^{\top}\left(\bm{x}\right)\frac{\partial\bm{A}^{-1}\left(\bm{x}\right)}{\partial x_{j}}\bm{B}_{i}\left(\bm{x}\right)+\bm{p}^{\top}\left(\bm{x}\right)\bm{A}^{-1}\left(\bm{x}\right)\frac{\partial\bm{B}_{i}\left(\bm{x}\right)}{\partial x_{j}},
\]

\end_inset

where
\begin_inset Formula 
\begin{gather*}
\frac{\partial\bm{B}_{i}}{\partial x_{j}}=\frac{\partial w_{i}\left(\bm{x}\right)}{\partial x_{j}}\bm{p}\left(\bm{x}_{i}\right),\\
\frac{\partial\bm{A}^{-1}\left(\bm{x}\right)}{\partial x_{j}}=-\bm{A}^{-1}\left(\bm{x}\right)\frac{\partial\bm{A}\left(\bm{x}\right)}{\partial x_{j}}\bm{A}^{-1}\left(\bm{x}\right),\\
\frac{\partial\bm{A}\left(\bm{x}\right)}{\partial x_{j}}=\sum_{i=1}^{n}\frac{\partial\hat{W}_{i}\left(\bm{x}\right)}{\partial x_{j}}\bm{p}\left(\bm{x}_{i}\right)\bm{p}^{\top}\left(\bm{x}_{i}\right).
\end{gather*}

\end_inset


\end_layout

\begin_layout Standard
Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mls-const"

\end_inset

 shows the MLS basis functions, which are not symmetric about the center
 as are RBFs.
 The defining feature of the MLS functions is the ability to exactly represent
 polynomials up to a defined order.
 In this case, only a linear basis is used.
 As is evident, the MLS basis functions are approximating the constant and
 linear functions to machine precision.
 
\end_layout

\begin_layout Standard
Like RBFs, MLS basis functions are not able to easily represent large discontinu
ities in the solution.
 Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mls-interpolation"

\end_inset

 shows the attempt at interpolating a square wave using MLS basis and weight
 functions without a sufficient number to finely resolve the discontinuities.
 As in the RBF case, the weak form does not have the Dirac delta property
 at the boundary, i.e.
 the value of the interpolant at the boundary does not equal the boundary
 condition.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figs/square_mls_17_2_basis.pdf
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Basis function set, 
\begin_inset Formula $\Gamma_{i}\left(\bm{x}\right)$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figs/square_mls_17_2_const.pdf
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Interpolation of a constant and a linear function
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Linear MLS basis with 17 points
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:mls-const"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figs/square_mls_17_2_partial.pdf
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Scaled basis functions for the pointwise interpolation, 
\begin_inset Formula $a_{i}\Gamma_{i}\left(\bm{x}\right)$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figs/square_mls_17_2_interp.pdf
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Interpolation result
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Interpolation of a square wave using 17 MLS basis and weight functions
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:mls-interpolation"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Part
Math
\end_layout

\begin_layout Section
Integrals in weak forms
\end_layout

\begin_layout Standard
For both the diffusion and the transport equation, integrals of the form
 
\begin_inset Formula 
\begin{equation}
\int_{V}w\left(\bm{x}\right)\bm{\nabla}\cdot\bm{F}\left(\bm{x}\right)dV
\end{equation}

\end_inset

must be done, which require either the chain rule,
\begin_inset Formula 
\begin{equation}
\bm{\nabla}\cdot\left(w\left(\bm{x}\right)\bm{F}\left(\bm{x}\right)\right)=\left[\bm{\nabla}w\left(\bm{x}\right)\right]\cdot\bm{F}\left(\bm{x}\right)+w\left(\bm{x}\right)\bm{\nabla}\cdot\bm{F}\left(\bm{x}\right),
\end{equation}

\end_inset

or integration by parts to get
\begin_inset Formula 
\begin{equation}
\int_{V}w\left(\bm{x}\right)\bm{\nabla}\cdot\bm{F}\left(\bm{x}\right)dV=\int_{V}\bm{\nabla}\cdot\left(w\left(\bm{x}\right)\bm{F}\left(\bm{x}\right)\right)dV-\int_{V}\left[\bm{\nabla}w\left(\bm{x}\right)\right]\cdot\bm{F}\left(\bm{x}\right)dV.
\end{equation}

\end_inset

Then using the divergence theorem gives
\begin_inset Formula 
\begin{equation}
\int_{V}\bm{\nabla}\cdot\left(w\left(\bm{x}\right)\bm{F}\left(\bm{x}\right)\right)dV=\int_{S}w\left(\bm{x}\right)\left(\bm{F}\left(\bm{x}\right)\cdot\bm{n}\right)dS,
\end{equation}

\end_inset

or in whole,
\begin_inset Formula 
\begin{equation}
\int_{V}w\left(\bm{x}\right)\bm{\nabla}\cdot\bm{F}\left(\bm{x}\right)dV=\int_{S}w\left(\bm{x}\right)\left(\bm{F}\left(\bm{x}\right)\cdot\bm{n}\right)dS-\int_{V}\left[\bm{\nabla}w\left(\bm{x}\right)\right]\cdot\bm{F}\left(\bm{x}\right)dV.
\end{equation}

\end_inset

For the transport equation, 
\begin_inset Formula 
\[
\bm{F}\left(\bm{x}\right)=\bm{\Omega}\psi\left(\bm{x},\bm{\Omega}\right),
\]

\end_inset

so the integral becomes
\begin_inset Formula 
\begin{equation}
\int_{V}w\left(\bm{x}\right)\bm{\Omega}\cdot\bm{\nabla}\psi\left(\bm{x},\bm{\Omega}\right)dV=\int_{S}w\left(\bm{x}\right)\left(\bm{\Omega}\cdot\bm{n}\right)\psi\left(\bm{x},\bm{\Omega}\right)dS-\int_{V}\left[\bm{\Omega}\cdot\bm{\nabla}w\left(\bm{x}\right)\right]\psi\left(\bm{x},\bm{\Omega}\right)dV.
\end{equation}

\end_inset

The diffusion equation has
\begin_inset Formula 
\[
\bm{F}\left(\bm{x}\right)=D\left(\bm{x}\right)\bm{\nabla}\phi\left(\bm{x}\right),
\]

\end_inset

so the volume integral becomes
\begin_inset Formula 
\begin{equation}
\int_{V}w\left(\bm{x}\right)\bm{\nabla}\cdot D\left(\bm{x}\right)\bm{\nabla}\phi\left(\bm{x}\right)dV=\int_{S}w\left(\bm{x}\right)D\left(\bm{x}\right)\left[\left(\bm{\nabla}\cdot\bm{n}\right)\phi\left(\bm{x}\right)\right]dS-\int_{V}D\left(\bm{x}\right)\left[\bm{\nabla}w\left(\bm{x}\right)\right]\cdot\left[\bm{\nabla}\phi\left(\bm{x}\right)\right]dV.
\end{equation}

\end_inset


\end_layout

\begin_layout Section
Legendre polynomials
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
Include algorithms for calculating.
\end_layout

\end_inset


\end_layout

\begin_layout Section
Spherical harmonics
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
Include algorithms for calculating.
\end_layout

\end_inset


\end_layout

\begin_layout Part
Geometry
\end_layout

\begin_layout Section
Quadrature sets
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
Cartesian 1D, 2D, 3D.
 Cylindrical 2D in cylindrical and Cartesian coordinates.
 Spherical 3D.
 Two circles intersecting in 2D.
\end_layout

\begin_layout Plain Layout
Include notes on 1D quadratures: must have smooth function to work with
 (boundaries must be used for accurate evaluation).
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The following equations convert from various geometries to an integral of
 the form
\begin_inset Formula 
\[
\int_{-1}^{1}f\left(\xi\right)d\xi=\sum_{i}w_{i}f\left(\xi_{i}\right),
\]

\end_inset

where the ordinates 
\begin_inset Formula $\xi_{i}$
\end_inset

 and weights 
\begin_inset Formula $w_{i}$
\end_inset

 are some 1D quadrature scheme such as the Gauss-Legendre ordinates.
 All the quadratures map the calculated quadrature back to Cartesian coordinates.
 
\end_layout

\begin_layout Subsection
Cartesian 1D
\end_layout

\begin_layout Standard
To convert from 
\begin_inset Formula $x\in\left[x_{1},x_{2}\right]$
\end_inset

 to 
\begin_inset Formula $\xi\in\left[-1,1\right]$
\end_inset

, use
\begin_inset Formula 
\[
x\left(\xi\right)=\frac{1-\xi}{2}x_{1}+\frac{1+\xi}{2}x_{2}
\]

\end_inset

to get
\begin_inset Formula 
\[
dx=\frac{x_{2}-x_{1}}{2}d\xi.
\]

\end_inset

The integral then becomes
\begin_inset Formula 
\begin{align*}
\int_{x_{1}}^{x_{2}}f\left(x\right)dx & =\frac{x_{2}-x_{1}}{2}\int_{-1}^{1}f\left(x\left(\xi\right)\right)d\xi\\
 & =\frac{x_{2}-x_{1}}{2}\sum_{i}w_{i}f\left(x\left(\xi_{i}\right)\right).
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
Cartesian 2D
\end_layout

\begin_layout Standard
To convert from 
\begin_inset Formula $x\in\left[x_{1},x_{2}\right]$
\end_inset

 and 
\begin_inset Formula $y\in\left[y_{1},y_{2}\right]$
\end_inset

 to 
\begin_inset Formula $\xi\in\left[-1,1\right]$
\end_inset

 and 
\begin_inset Formula $\eta\in\left[-1,1\right]$
\end_inset

, use similar rules to the 1D case,
\begin_inset Formula 
\begin{gather*}
x\left(\xi\right)=\frac{1-\xi}{2}x_{1}+\frac{1+\xi}{2}x_{2},\\
y\left(\eta\right)=\frac{1-\eta}{2}y_{1}+\frac{1-\eta}{2}y_{2},
\end{gather*}

\end_inset

to get the independent differentials,
\begin_inset Formula 
\begin{gather*}
dx=\frac{x_{2}-x_{1}}{2}d\xi,\\
dy=\frac{y_{2}-y_{1}}{2}d\eta.
\end{gather*}

\end_inset

The integral is
\begin_inset Formula 
\begin{align*}
\int_{x_{1}}^{x_{2}}\int_{y_{1}}^{y_{2}}f\left(x,y\right)dxdy & =\frac{x_{2}-x_{1}}{2}\frac{y_{2}-y_{1}}{2}\int_{-1}^{1}\int_{-1}^{1}f\left(x\left(\xi\right),y\left(\eta\right)\right)d\xi d\eta\\
 & =\frac{x_{2}-x_{1}}{2}\frac{y_{2}-y_{1}}{2}\sum_{i,j}w_{i}w_{j}f\left(x\left(\xi_{i}\right),y\left(\eta_{j}\right)\right).
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
Cylindrical 2D
\end_layout

\begin_layout Standard
Use 
\begin_inset Formula 
\begin{gather*}
r=\frac{1-\xi}{2}r_{1}+\frac{1+\xi}{2}r_{2},\\
\theta=\frac{1-\eta}{2}\theta_{1}+\frac{1+\eta}{2}\theta_{2},
\end{gather*}

\end_inset

where 
\begin_inset Formula $\theta\in\left[0,2\pi\right]$
\end_inset

 and 
\begin_inset Formula $r\in\left[0,R\right]$
\end_inset

, which has the differentials
\begin_inset Formula 
\begin{gather*}
dr=\frac{r_{2}-r_{1}}{2}d\xi,\\
d\theta=\frac{\theta_{2}-\theta_{1}}{2}d\eta.
\end{gather*}

\end_inset

The conversion to Cartesian coordinates is
\begin_inset Formula 
\begin{gather*}
x\left(r,\theta\right)=x_{0}+r\cos\theta,\\
y\left(r,\theta\right)=y_{0}+r\sin\theta,
\end{gather*}

\end_inset

where 
\begin_inset Formula $\bm{x}_{0}$
\end_inset

 is the location of the center of the cylinder.
 Then the cylindrical-geometry integral is
\begin_inset Formula 
\begin{align*}
\int_{\theta_{1}}^{\theta_{2}}\int_{r_{1}}^{r_{2}}f\left(x\left(r,\theta\right),y\left(r,\theta\right)\right)rdrd\theta & =\frac{r_{2}-r_{1}}{2}\frac{\theta_{2}-\theta_{1}}{2}\int_{-1}^{1}\int_{-1}^{1}f\left(x\left(r\left(\xi\right),\theta\left(\eta\right)\right),y\left(r\left(\xi\right),\theta\left(\eta\right)\right)\right)r\left(\xi\right)d\xi d\eta\\
 & =\frac{r_{2}-r_{1}}{2}\frac{\theta_{2}-\theta_{1}}{2}\sum_{i,j}f\left(x\left(r\left(\xi_{i}\right),\theta\left(\eta_{j}\right)\right),y\left(r\left(\xi_{i}\right),\theta\left(\eta_{j}\right)\right)\right)r\left(\xi\right).
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
Spherical 3D
\end_layout

\begin_layout Standard
For the 3D spherical-geometry integral, we use
\begin_inset Formula 
\begin{gather*}
r=\frac{1-\xi}{2}r_{1}+\frac{1+\xi}{2}r_{2},\\
\theta=\frac{1-\eta}{2}\theta_{1}+\frac{1+\eta}{2}\theta_{2},\\
\phi=\frac{1-\zeta}{2}\phi_{1}+\frac{1+\zeta}{2}\phi_{2},
\end{gather*}

\end_inset

where 
\begin_inset Formula $r\in\left[0,r\right]$
\end_inset

, 
\begin_inset Formula $\theta\in\left[0,2\pi\right]$
\end_inset

, 
\begin_inset Formula $\phi\in\left[0,\pi\right]$
\end_inset

.
 The differentials are
\begin_inset Formula 
\begin{gather*}
dr=\frac{r_{2}-r_{1}}{2}d\xi,\\
d\theta=\frac{\theta_{2}-\theta_{1}}{2}d\eta,\\
d\phi=\frac{\phi_{2}-\phi_{1}}{2}d\zeta.
\end{gather*}

\end_inset

The conversion to Cartesian coordinates is
\begin_inset Formula 
\begin{gather*}
x\left(r,\theta,\phi\right)=x_{0}+r\cos\theta\sin\phi,\\
y\left(r,\theta,\phi\right)=y_{0}+r\sin\theta\sin\phi,\\
z\left(r,\theta,\phi\right)=z_{0}+r\cos\phi,
\end{gather*}

\end_inset

where 
\begin_inset Formula $\bm{x}_{0}$
\end_inset

 is the location of the center of the sphere.
 Then the integral is
\begin_inset Formula 
\begin{multline*}
\int_{0}^{\pi}\int_{0}^{2\pi}\int_{0}^{r}f\left(x\left(r,\theta,\phi\right),y\left(r,\theta,\phi\right),z\left(r,\phi\right)\right)r^{2}\sin\phi drd\theta d\phi\\
=\frac{r_{2}-r_{1}}{2}\frac{\theta_{2}-\theta_{1}}{2}\frac{\phi_{2}-\phi_{1}}{2}\iiint_{-1}^{1}f\left(x\left(r\left(\xi\right),\theta\left(\eta\right),\phi\left(\zeta\right)\right),y\left(r\left(\xi\right),\theta\left(\eta\right),\phi\left(\zeta\right)\right),z\left(r\left(\xi\right),\phi\left(\zeta\right)\right)\right)r^{2}\left(\xi\right)\sin\phi\left(\zeta\right)drd\theta d\phi\\
=\frac{r_{2}-r_{1}}{2}\frac{\theta_{2}-\theta_{1}}{2}\frac{\phi_{2}-\phi_{1}}{2}\sum_{i,j,k}f\left(x\left(r\left(\xi_{i}\right),\theta\left(\eta_{j}\right),\phi\left(\zeta_{k}\right)\right),y\left(r\left(\xi_{i}\right),\theta\left(\eta_{j}\right),\phi\left(\zeta_{k}\right)\right),z\left(r\left(\xi_{i}\right),\phi\left(\zeta_{k}\right)\right)\right)r^{2}\left(\xi_{i}\right)\sin\phi\left(\zeta_{k}\right)drd\theta d\phi.
\end{multline*}

\end_inset


\end_layout

\begin_layout Subsection
Lens in 2D
\end_layout

\begin_layout Standard
For a lens, we have the intersection of two circles as the region of integration.
 In all cases, we will map the two circles into a simple coordinate system
 and then rotate/translate the ordinates back into the original coordinates.
 There are three different cases to be considered, which can be seen in
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:lens-cases"

\end_inset

.
 For the third case, we can use a simple cylindrical quadrature.
 For the first two, different quadratures must be used.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figs/lens_2.5_1_2.5.pdf
	width 30text%

\end_inset


\begin_inset Graphics
	filename figs/lens_2_1_2.5.pdf
	width 30text%

\end_inset


\begin_inset Graphics
	filename figs/lens_2_1_3.pdf
	width 30text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Three lens cases: a standard lens, a non-standard lens, and a full circle
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:lens-cases"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Simple lens
\end_layout

\begin_layout Standard
Let the simplified coordinate system 
\begin_inset Formula $\tilde{x}$
\end_inset

, 
\begin_inset Formula $\tilde{y}$
\end_inset

 be defined by 
\begin_inset Formula 
\[
\left[\begin{array}{c}
x\\
y
\end{array}\right]=\left[\begin{array}{c}
x_{1}\\
y_{1}
\end{array}\right]+\frac{1}{d}\left[\begin{array}{cc}
\Delta x & -\Delta y\\
\Delta y & \Delta x
\end{array}\right]\left[\begin{array}{c}
\tilde{x}\\
\tilde{y}
\end{array}\right],
\]

\end_inset

where the distance between the basis functions is 
\begin_inset Formula 
\begin{gather*}
\Delta x=x_{2}-x_{1},\\
\Delta y=y_{2}-y_{1},\\
d=\sqrt{\Delta x^{2}+\Delta y^{2}}.
\end{gather*}

\end_inset

This describes a coordinate system with the first circle centered at the
 origin and the second circle a distance 
\begin_inset Formula $d$
\end_inset

 away in the 
\begin_inset Formula $+\hat{x}$
\end_inset

 direction.
 Then in the new coordinate system, we can write the circle equations as
\begin_inset Formula 
\begin{gather*}
x^{2}+y^{2}=r_{1}^{2},\\
\left(x-d\right)^{2}+y^{2}=r_{2}^{2}.
\end{gather*}

\end_inset

 The intercepts of these two circles are 
\begin_inset Formula 
\begin{gather*}
\tilde{x}_{int}=\frac{d^{2}+r_{1}^{2}-r_{2}^{2}}{2d},\\
\tilde{y}_{int}=\pm\frac{\sqrt{2d^{2}\left(r_{1}^{2}+r_{2}^{2}\right)-\left(r_{1}^{2}-r_{2}^{2}\right)^{2}-d^{4}}}{2d}.
\end{gather*}

\end_inset

If we define 
\begin_inset Formula 
\begin{gather*}
\tilde{x}_{min}\left(\tilde{y}\right)=d-\sqrt{r_{2}^{2}-\tilde{y}^{2}},\\
\tilde{x}_{max}\left(\tilde{y}\right)=\sqrt{r_{1}^{2}-\tilde{y}^{2}},
\end{gather*}

\end_inset

then our integral over the lens is of the form
\begin_inset Formula 
\[
\int_{-\tilde{y}_{int}}^{\tilde{y}_{int}}\int_{\tilde{x}_{min}\left(\tilde{y}\right)}^{\tilde{x}_{max}\left(\tilde{y}\right)}f\left(\tilde{x},\tilde{y}\right)dxdy,
\]

\end_inset

which can be converted to 
\begin_inset Formula $\xi\in\left[-1,1\right]$
\end_inset

 and 
\begin_inset Formula $\eta\in\left[-1,1\right]$
\end_inset

 using
\begin_inset Formula 
\begin{gather*}
x=\frac{\tilde{x}_{max}\left(\tilde{y}\left(\eta\right)\right)-\tilde{x}_{min}\left(\tilde{y}\left(\eta\right)\right)}{2}\xi+\frac{\tilde{x}_{max}\left(\tilde{y}\left(\eta\right)\right)+\tilde{x}_{min}\left(\tilde{y}\left(\eta\right)\right)}{2},\\
\tilde{y}=\tilde{y}_{int}\eta.
\end{gather*}

\end_inset

The Jacobian determinant for this is
\begin_inset Formula 
\begin{align*}
J & =\left|\begin{array}{cc}
\dfrac{d\tilde{x}}{d\xi} & \dfrac{d\tilde{x}}{d\eta}\\
\dfrac{d\tilde{y}}{d\xi} & \dfrac{d\tilde{y}}{d\eta}
\end{array}\right|\\
 & =\left(\frac{\tilde{x}_{max}\left(\tilde{y}\left(\eta\right)\right)-\tilde{x}_{min}\left(\tilde{y}\left(\eta\right)\right)}{2}\right)\tilde{y}_{int},
\end{align*}

\end_inset

after which the integral becomes
\begin_inset Formula 
\[
\int_{-1}^{1}\int_{-1}^{1}f\left(\tilde{x}\left(\xi,\eta\right),\tilde{y}\left(\eta\right)\right)\left(\frac{\tilde{x}_{max}\left(\tilde{y}\left(\eta\right)\right)-\tilde{x}_{min}\left(\tilde{y}\left(\eta\right)\right)}{2}\right)\tilde{y}_{int}d\xi d\eta.
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Non-standard lens
\end_layout

\begin_layout Standard
If we assume that the first circle with 
\begin_inset Formula $r_{1}$
\end_inset

 has the smaller radius 
\begin_inset Formula $\left(r_{1}<r_{2}\right)$
\end_inset

 and the 
\begin_inset Formula $\tilde{x}$
\end_inset

 intercept is past the center of this circle, then the integral is identical
 to the standard lens except for the definitions 
\begin_inset Formula 
\begin{gather*}
\tilde{x}_{min}\left(\tilde{y}\right)=\begin{cases}
d-\sqrt{r_{2}^{2}-\tilde{y}^{2}}, & \left|\tilde{y}\right|\leq\tilde{y}_{int},\\
-\sqrt{r_{1}^{2}-\tilde{y}^{2}}, & \text{otherwise},
\end{cases}\\
\tilde{x}_{max}\left(y\right)=\sqrt{r_{1}^{2}-\tilde{y}^{2}}.
\end{gather*}

\end_inset

If 
\begin_inset Formula $r_{2}>r_{1}$
\end_inset

, then the definitions become
\begin_inset Formula 
\begin{gather*}
\tilde{x}_{min}\left(\tilde{y}\right)=d-\sqrt{r_{2}^{2}-\tilde{y}^{2}},\\
\tilde{x}_{max}\left(\tilde{y}\right)=\begin{cases}
\sqrt{r_{1}^{2}-\tilde{y}^{2}}, & \left|\tilde{y}\right|\leq\tilde{y}_{int},\\
d+\sqrt{r_{2}^{2}-\tilde{y}^{2}}, & \text{otherwise}.
\end{cases}
\end{gather*}

\end_inset


\end_layout

\begin_layout Subsection
Quadratures near boundaries
\end_layout

\begin_layout Standard
Near boundaries, the most important thing is that the quadrature not extend
 past the boundary.
 Since the functions we're integrating fall off away from the center, they're
 smooth even as they become zero.
 However, if we include quadrature points past the boundary (and artificially
 set the weights of these quadrature points to zero), the function we're
 integrating is no longer smooth, which means that the quadratures will
 no longer behave ideally.
 
\end_layout

\begin_layout Standard
One easy-to-derive quadrature for use near boundaries is the integration
 over a cylinder with Cartesian limits 
\begin_inset Formula $x_{min,max}$
\end_inset

 and 
\begin_inset Formula $y_{min,max}$
\end_inset

.
 For this, we create an array of 
\begin_inset Formula $x$
\end_inset

 points with 
\begin_inset Formula $x\in\left[\max\left(x_{0}-r,x_{min}\right),\min\left(x_{0}+r,x_{max}\right)\right]$
\end_inset

 and then integrate in 
\begin_inset Formula $y$
\end_inset

 between the top and bottom of the circle at the point 
\begin_inset Formula $x$
\end_inset

, taking into account the 
\begin_inset Formula $y$
\end_inset

 intercepts to get 
\begin_inset Formula $y\in\left[\max\left(y_{0}-\sqrt{r^{2}-x^{2}},y_{min}\right),\min\left(y_{0}+\sqrt{r^{2}-x^{2}},y_{max}\right)\right]$
\end_inset

.
 
\end_layout

\begin_layout Standard
Quadratures for lenses that intersect boundaries are possible but not practical,
 particularly when going to 3D cases with the intersection of a basis function,
 weight function and up to three planes that make up a corner.
 For these cases, using a Cartesian or other quadrature that extends beyond
 the area where the functions have gone to zero but tightly holds to the
 boundary works well.
 
\end_layout

\begin_layout Section
Solid geometry
\end_layout

\begin_layout Subsection
Shape-specific values
\end_layout

\begin_layout Standard
For each surface in a constructive solid geometry, the following information
 is needed to run a particle simulation:
\end_layout

\begin_layout Itemize
The normal vector of the surface at each point on the surface,
\end_layout

\begin_layout Itemize
The distance to intersection and point of intersection of a particle incident
 on the surface, and
\end_layout

\begin_layout Itemize
Whether a particle is positive or negative from a surface (which can be
 arbitrarily defined).
 
\end_layout

\begin_layout Standard
These quantities are calculated below for a plane, a cylinder and a sphere,
 all with arbitrary position and orientation.
 
\end_layout

\begin_layout Subsubsection
Plane
\end_layout

\begin_layout Standard
The general equation for a plane with normal vector 
\begin_inset Formula $\bm{n}$
\end_inset

 is
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left(\bm{x}-\bm{x}_{0}\right)\cdot\bm{n}=0.
\end{equation}

\end_inset

Let the particle position be 
\begin_inset Formula 
\begin{equation}
\bm{x}_{p}\left(s\right)=\bm{g}_{0}+\bm{g}_{1}s
\end{equation}

\end_inset

and plug it in.
 Solving for 
\begin_inset Formula $s$
\end_inset

 gives
\begin_inset Formula 
\begin{equation}
s=\frac{\left(\bm{x}_{0}-\bm{g}_{0}\right)\cdot\bm{n}}{\bm{g}_{1}\cdot\bm{n}}.
\end{equation}

\end_inset

This is the distance to intersection.
 The point of intersection can be found by advancing the particle by distance
 
\begin_inset Formula $s$
\end_inset

.
 To find the geometric relationship between a particle and a plane, we have
 
\begin_inset Formula 
\[
\bm{n}\cdot\left(\bm{x}-\bm{x}_{0}\right)\begin{cases}
>0, & \text{positive},\\
<0, & \text{negative},\\
=0, & \text{coincident}.
\end{cases}
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Cylinder
\end_layout

\begin_layout Standard
Begin with the equation for a cylinder with the centerline having an axis
 in direction 
\begin_inset Formula $\bm{\Omega}$
\end_inset

 that runs through the point 
\begin_inset Formula $\bm{x}$
\end_inset

.
 The equation for this cylinder is
\begin_inset Formula 
\[
\left\Vert \bm{x}-\bm{x}_{0}-\bm{\Omega}\cdot\left(\bm{x}-\bm{x}_{0}\right)\bm{\Omega}\right\Vert ^{2}=r^{2}.
\]

\end_inset

If we again define the particle position as 
\begin_inset Formula 
\begin{equation}
\bm{x}_{p}\left(s\right)=\bm{g}_{0}+\bm{g}_{1}s,
\end{equation}

\end_inset

then we get 
\begin_inset Formula 
\[
\left\Vert \bm{k}_{0}+\bm{k}_{1}s\right\Vert ^{2}=r^{2},
\]

\end_inset

with 
\begin_inset Formula 
\begin{gather*}
\bm{k}_{0}=\left[\bm{g}_{0}-\bm{x}_{0}-\bm{\Omega}\cdot\left(\bm{g}_{0}-\bm{x}_{0}\right)\bm{\Omega}\right],\\
\bm{k}_{1}=\left[\bm{g}_{1}-\left(\bm{\Omega}\cdot\bm{g}_{1}\right)\bm{\Omega}\right].
\end{gather*}

\end_inset

Here 
\begin_inset Formula $\bm{k}_{0}$
\end_inset

 represents the vector rejection of 
\begin_inset Formula $\bm{g}_{0}-\bm{x}_{0}$
\end_inset

 onto 
\begin_inset Formula $\bm{\Omega}$
\end_inset

, or the part of the vector connecting the midpoint of the cylinder to the
 position of the particle that is perpendicular to the cylinder axis.
 
\begin_inset Formula $\bm{k}_{1}$
\end_inset

 is the same thing, except for 
\begin_inset Formula $\bm{g}_{1}$
\end_inset

, the direction of the particle.
 The equation can further simplify to 
\begin_inset Formula 
\begin{align*}
r^{2} & =\left(\bm{k}_{0}+\bm{k}_{1}s\right)\cdot\left(\bm{k}_{0}+\bm{k}_{1}s\right)\\
 & =\bm{k}_{0}\cdot\bm{k}_{0}+2\bm{k}_{0}\cdot\bm{k}_{1}s+\bm{k}_{1}\cdot\bm{k}_{1}s^{2}.
\end{align*}

\end_inset

Defining 
\begin_inset Formula 
\begin{gather*}
\ell_{0}=\bm{k}_{0}\cdot\bm{k}_{0}-r^{2},\\
\ell_{1}=\bm{k}_{0}\cdot\bm{k}_{1},\\
\ell_{2}=\bm{k}_{1}\cdot\bm{k}_{1},
\end{gather*}

\end_inset

the solution to this equation is
\begin_inset Formula 
\[
s=\frac{-\ell_{1}\pm\sqrt{\ell_{1}^{2}-\ell_{0}\ell_{2}}}{\ell_{2}},
\]

\end_inset

which is the distance to collision of the particle with the cylinder.
 Moving the particle ahead by this distance will move it to the site of
 intersection.
 If 
\begin_inset Formula $l_{2}=0$
\end_inset

, the particle continues along the axis of the line forever.
 If 
\begin_inset Formula 
\[
\ell_{1}^{2}-\ell_{0}\ell_{2}<0,
\]

\end_inset

there are no intersections.
 
\end_layout

\begin_layout Standard
To find the relationship between a cylinder and a particle, the equation
 is the same as before but with 
\begin_inset Formula $\bm{k}_{1}=\bm{0}$
\end_inset

, which gives
\begin_inset Formula 
\[
\bm{k}_{0}\cdot\bm{k}_{0}=r^{2},
\]

\end_inset

or
\begin_inset Formula 
\[
\ell_{0}\begin{cases}
>0, & \text{outside},\\
<0, & \text{inside},\\
=0, & \text{coincident}.
\end{cases}
\]

\end_inset

The normal direction of a cylinder at a point 
\begin_inset Formula $\bm{g}_{0}$
\end_inset

 can be found by normalizing the 
\begin_inset Formula $\bm{k}_{0}$
\end_inset

 vector,
\begin_inset Formula 
\[
\hat{\bm{n}}=\frac{\bm{k}_{0}}{\left\Vert \bm{k}_{0}\right\Vert }.
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Sphere
\end_layout

\begin_layout Standard
The equation of a sphere is
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left\Vert \bm{x}-\bm{x}_{0}\right\Vert ^{2}=r^{2},
\end{equation}

\end_inset

which using the same 
\begin_inset Formula 
\begin{equation}
\bm{x}_{p}\left(s\right)=\bm{g}_{0}+\bm{g}_{1}s
\end{equation}

\end_inset

as before gives
\begin_inset Formula 
\[
\left\Vert \bm{g}_{0}+\bm{g}_{1}s-\bm{x}_{0}\right\Vert ^{2}=r^{2}.
\]

\end_inset

Letting 
\begin_inset Formula 
\begin{gather*}
\bm{k}_{0}=\bm{g}_{0}-\bm{x}_{0},\\
\bm{k}_{1}=\bm{g}_{1},
\end{gather*}

\end_inset

the results from the cylinder follow exactly.
 The difference is that 
\begin_inset Formula 
\[
\ell_{2}=\bm{g}_{1}\cdot\bm{g}_{1}=1,
\]

\end_inset

so that the equation can be simplified to 
\begin_inset Formula 
\[
s=-\ell_{1}\pm\sqrt{\ell_{1}^{2}-\ell_{0}},
\]

\end_inset

with 
\begin_inset Formula 
\begin{gather*}
\ell_{0}=\bm{k}_{0}\cdot\bm{k}_{0}-r^{2},\\
\ell_{1}=\bm{k}_{0}\cdot\bm{k}_{1}.
\end{gather*}

\end_inset

To check if a particle is inside of the problem, use
\begin_inset Formula 
\[
\ell_{0}\begin{cases}
>0, & \text{outside},\\
<0, & \text{inside},\\
=0, & \text{coincident},
\end{cases}
\]

\end_inset

as before.
 The normal direction of a cylinder at point 
\begin_inset Formula $\bm{g}_{0}$
\end_inset

 is 
\begin_inset Formula 
\[
\hat{n}=\frac{\bm{k}_{0}}{\left\Vert \bm{k}_{0}\right\Vert }.
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Greyedout
status open

\begin_layout Part
Tests
\end_layout

\begin_layout Plain Layout
\begin_inset Note Comment
status open

\begin_layout Plain Layout
Include pictures of test when possible.
\end_layout

\end_inset


\end_layout

\begin_layout Section
Utilities
\end_layout

\begin_layout Subsection
Indexing
\end_layout

\begin_layout Plain Layout
The indexing test 
\begin_inset Quotes eld
\end_inset

tst_indexing
\begin_inset Quotes erd
\end_inset

 tests whether the subscript to index and index to subscript functions work
 appropriately to restore a given subscript after converting it to the index
 and back.
 
\end_layout

\begin_layout Subsection
Integration
\end_layout

\begin_layout Subsection
Linear algebra
\end_layout

\begin_layout Plain Layout
This tests the analytic linear solves against a Trilinos solve.
 A random matrix 
\begin_inset Formula $\bm{A}$
\end_inset

 and vector 
\begin_inset Formula $\bm{b}$
\end_inset

 are created, after which the solution is performed using each of the analytic
 solves and the Trilinos solution to get the vector 
\begin_inset Formula $\bm{x}$
\end_inset

.
 If the 
\begin_inset Formula $L_{\infty}$
\end_inset

 difference between these two vectors is less than the tolerance, the test
 is passed.
 
\end_layout

\begin_layout Subsection
Math functions
\end_layout

\begin_layout Subsubsection
Factorial
\end_layout

\begin_layout Plain Layout
The factorial test compares the analytic value of 
\begin_inset Formula $12!$
\end_inset

 with a calculated value.
 
\end_layout

\begin_layout Subsubsection
Legendre polynomial
\end_layout

\begin_layout Subsubsection
Spherical harmonics
\end_layout

\begin_layout Subsection
Quadrature
\end_layout

\begin_layout Subsubsection
Gaussian 2D
\end_layout

\begin_layout Subsubsection
Double Gaussian 2D
\end_layout

\begin_layout Subsubsection
Boundary Gaussian 2D
\end_layout

\begin_layout Subsection
Sparse storage
\end_layout

\begin_layout Subsection
Trilinos
\end_layout

\begin_layout Subsection
Vector functions
\end_layout

\begin_layout Plain Layout
Tests vector functions against analytic results.
 
\end_layout

\begin_layout Section
Angular discretization
\end_layout

\begin_layout Subsection
Gauss-Legendre
\end_layout

\begin_layout Subsection
LDFE
\end_layout

\begin_layout Section
Solid geometry
\end_layout

\begin_layout Section
Spatial discretization
\end_layout

\begin_layout Section
Operator
\end_layout

\begin_layout Section
Transport
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{thebibliography}{99}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
bibitem{warsa-krylov-2004}
\end_layout

\begin_layout Plain Layout

J.S.
 WARSA, T.A WAREING, J.E.
 MOREL, ``Krylov Iterative Methods and the Degraded Effectiveness of Diffusion
 Synthetic Acceleration for Multidimensional $S_N$ Calculations in Problems
 with Material Discontinuities,'' {
\backslash
it Nucl.
 Sci.
 Eng.}, {
\backslash
bf 147}(3), 218-248 (2004).
 
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
bibitem{chen-recent-2014}
\end_layout

\begin_layout Plain Layout

W.
 CHEN, Z.
 FU, C.
 CHEN, {
\backslash
it Recent Advances in Radial Basis Function Collocation Methods}, Springer
 (2014).
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
end{thebibliography}
\end_layout

\end_inset


\end_layout

\end_body
\end_document
